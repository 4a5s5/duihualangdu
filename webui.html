<!DOCTYPE html>
<html lang="zh-Hans">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <title>üéôÔ∏è AIËØ≠Èü≥Âä©Êâã | Êô∫ËÉΩÂØπËØù+TTSÊúçÂä° (v4.0)</title>
  <style>
    :root {
      --primary-color: #667eea;
      --primary-dark: #5a67d8;
      --secondary-color: #f093fb;
      --success-color: #48bb78;
      --error-color: #f56565;
      --warning-color: #ed8936;
      --light-gray: #f7fafc;
      --gray: #718096;
      --border-color: #e2e8f0;
      --text-color: #2d3748;
      --text-light: #4a5568;

      /* Êñ∞ÁöÑÊ∏êÂèòËâ≤ÂΩ©ÊñπÊ°à */
      --gradient-start: #ff9a9e;
      --gradient-middle: #fecfef;
      --gradient-end: #fecfef;
      --gradient-accent: #a8edea;

      /* Âç°ÁâáÂíåÈù¢ÊùøÈ¢úËâ≤ */
      --card-bg: rgba(255, 255, 255, 0.95);
      --card-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
      --card-shadow-hover: 0 15px 35px rgba(0, 0, 0, 0.15);

      /* ÊåâÈíÆÊ∏êÂèò */
      --btn-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      --btn-gradient-hover: linear-gradient(135deg, #5a67d8 0%, #6b46c1 100%);
      --btn-success-gradient: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
      --btn-warning-gradient: linear-gradient(135deg, #ed8936 0%, #dd6b20 100%);
    }

    * {
      box-sizing: border-box;
    }

    html {
      padding: 0;
      margin: 0;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
        "Helvetica Neue", Arial, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", sans-serif;
      background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 50%, #fecfef 100%);
      background-attachment: fixed;
      min-height: 100vh;
      color: var(--text-color);
      line-height: 1.6;
      padding: 0;
      margin: 0;
      position: relative;
    }

    /* Ê∑ªÂä†ËÉåÊôØË£ÖÈ•∞ */
    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background:
        radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
        radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.3) 0%, transparent 50%),
        radial-gradient(circle at 40% 40%, rgba(120, 219, 255, 0.2) 0%, transparent 50%);
      pointer-events: none;
      z-index: -1;
    }

    [v-cloak] {
      display: none;
    }

    .app-container {
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
      padding: 1rem 0 2rem;
    }

    .container {
      max-width: 1200px;
      width: 100%;
      background: var(--card-bg);
      backdrop-filter: blur(20px);
      padding: 2.5rem;
      border-radius: 24px;
      box-shadow: var(--card-shadow);
      border: 1px solid rgba(255, 255, 255, 0.3);
      position: relative;
      overflow: hidden;
    }

    .container::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, #ff9a9e 0%, #fecfef 50%, #a8edea 100%);
      border-radius: 24px 24px 0 0;
    }

    /* Ê®°ÂºèÂàáÊç¢Ê†∑Âºè */
    .mode-toggle {
      text-align: center;
      margin-bottom: 2.5rem;
    }

    .mode-toggle .btn-group {
      background: rgba(255, 255, 255, 0.9);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
      border-radius: 50px;
      overflow: hidden;
      padding: 4px;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.3);
    }

    .mode-toggle .btn {
      padding: 1rem 2.5rem;
      font-weight: 600;
      border: none;
      border-radius: 46px;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
      font-size: 0.95rem;
    }

    .mode-toggle .btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
      transition: left 0.5s;
    }

    .mode-toggle .btn:hover::before {
      left: 100%;
    }

    .mode-toggle .btn.active {
      background: var(--btn-gradient);
      color: white;
      transform: scale(1.02);
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
    }

    .mode-toggle .btn:not(.active) {
      background: transparent;
      color: var(--text-color);
    }

    .mode-toggle .btn:not(.active):hover {
      background: rgba(255, 255, 255, 0.6);
      transform: translateY(-1px);
    }

    /* AIÂØπËØùÊ®°ÂºèÊ†∑Âºè */
    .chat-container {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 2rem;
      height: 70vh;
    }

    .chat-area {
      display: flex;
      flex-direction: column;
      background: var(--card-bg);
      border-radius: 20px;
      box-shadow: var(--card-shadow);
      overflow: hidden;
      border: 1px solid rgba(255, 255, 255, 0.3);
      backdrop-filter: blur(10px);
    }

    .chat-header {
      background: linear-gradient(135deg, #ff6b6b 0%, #feca57 100%);
      color: white;
      padding: 1.2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: relative;
      overflow: hidden;
    }

    .chat-header::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
      animation: shimmer 3s infinite;
    }

    @keyframes shimmer {
      0% { left: -100%; }
      100% { left: 100%; }
    }

    .chat-header h3 {
      margin: 0;
      font-size: 1.1rem;
      font-weight: 600;
      position: relative;
      z-index: 1;
    }

    .chat-header .btn {
      background: rgba(255, 255, 255, 0.2);
      border: 1px solid rgba(255, 255, 255, 0.3);
      color: white;
      border-radius: 8px;
      padding: 0.4rem 0.8rem;
      margin-left: 0.5rem;
      transition: all 0.3s ease;
      position: relative;
      z-index: 1;
    }

    .chat-header .btn:hover {
      background: rgba(255, 255, 255, 0.3);
      transform: translateY(-1px);
    }

    .chat-messages {
      flex: 1;
      overflow-y: auto;
      padding: 1.5rem;
      background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
      position: relative;
    }

    .chat-messages::-webkit-scrollbar {
      width: 6px;
    }

    .chat-messages::-webkit-scrollbar-track {
      background: rgba(0, 0, 0, 0.1);
      border-radius: 3px;
    }

    .chat-messages::-webkit-scrollbar-thumb {
      background: linear-gradient(135deg, #667eea, #764ba2);
      border-radius: 3px;
    }

    .message {
      margin-bottom: 1.5rem;
      display: flex;
      align-items: flex-start;
      gap: 0.8rem;
      animation: fadeInUp 0.5s ease-out;
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .message.user {
      flex-direction: row-reverse;
    }

    .message-content {
      max-width: 75%;
      padding: 1rem 1.2rem;
      border-radius: 18px;
      position: relative;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      backdrop-filter: blur(10px);
    }

    .message.user .message-content {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border-bottom-right-radius: 6px;
    }

    .message.ai .message-content {
      background: rgba(255, 255, 255, 0.95);
      color: var(--text-color);
      border: 1px solid rgba(255, 255, 255, 0.3);
      border-bottom-left-radius: 6px;
    }

    .message-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.9rem;
      flex-shrink: 0;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      border: 2px solid rgba(255, 255, 255, 0.3);
    }

    .message.user .message-avatar {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }

    .message.ai .message-avatar {
      background: linear-gradient(135deg, #ff6b6b 0%, #feca57 100%);
      color: white;
    }

    .message-controls {
      margin-top: 0.8rem;
      display: flex;
      gap: 0.5rem;
    }

    .message-controls .btn {
      padding: 0.4rem 0.8rem;
      font-size: 0.8rem;
      border-radius: 12px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border: none;
      color: white;
      transition: all 0.3s ease;
      box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
    }

    .message-controls .btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
    }

    .chat-input-area {
      padding: 1.5rem;
      background: rgba(255, 255, 255, 0.95);
      border-top: 1px solid rgba(255, 255, 255, 0.3);
      backdrop-filter: blur(10px);
    }

    .chat-input-area .input-group {
      align-items: flex-end;
      display: flex;
      gap: 1rem;
    }

    .chat-input-area textarea {
      flex: 1;
      resize: none;
      border-radius: 20px;
      border: 2px solid rgba(102, 126, 234, 0.2);
      padding: 1rem 1.2rem;
      background: rgba(255, 255, 255, 0.9);
      transition: all 0.3s ease;
      font-size: 0.95rem;
    }

    .chat-input-area textarea:focus {
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
      outline: none;
    }

    .chat-input-area .btn {
      border-radius: 50%;
      width: 50px;
      height: 50px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--btn-gradient);
      border: none;
      color: white;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
    }

    .chat-input-area .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
    }

    /* ËØ≠Èü≥ÊéßÂà∂Èù¢ÊùøÊ†∑Âºè */
    .voice-control-panel {
      background: var(--card-bg);
      border-radius: 20px;
      box-shadow: var(--card-shadow);
      padding: 2rem;
      height: fit-content;
      border: 1px solid rgba(255, 255, 255, 0.3);
      backdrop-filter: blur(10px);
      position: relative;
      overflow: hidden;
    }

    .voice-control-panel::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, #a8edea 0%, #fed6e3 100%);
      border-radius: 20px 20px 0 0;
    }

    .voice-control-panel h3 {
      color: var(--text-color);
      margin-bottom: 1.5rem;
      font-size: 1.2rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .voice-control-panel h3 i {
      color: #ff6b6b;
    }

    .voice-control-panel.with-debug {
      height: 50vh;
      overflow-y: auto;
    }

    /* Vue.js cloak */
    [v-cloak] {
      display: none;
    }

    /* Ë∞ÉËØïÈù¢ÊùøÊ†∑Âºè */
    .debug-panel {
      background: var(--card-bg);
      border-radius: 20px;
      box-shadow: var(--card-shadow);
      padding: 1.5rem;
      margin-bottom: 2rem;
      border: 1px solid rgba(255, 255, 255, 0.3);
      backdrop-filter: blur(10px);
      position: relative;
      overflow: hidden;
      animation: slideInDown 0.3s ease-out;
    }

    @keyframes slideInDown {
      from {
        opacity: 0;
        transform: translateY(-20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .debug-panel::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, #f59e0b 0%, #d97706 100%);
      border-radius: 20px 20px 0 0;
    }

    .debug-panel h3 {
      margin-top: 0;
      margin-bottom: 1rem;
      color: var(--text-color);
      font-size: 1.1rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .debug-panel h3 i {
      color: #f59e0b;
    }

    .debug-controls {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 1rem;
    }

    .debug-logs {
      max-height: 300px;
      overflow-y: auto;
      background: rgba(0, 0, 0, 0.05);
      border-radius: 12px;
      padding: 1rem;
      font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
      font-size: 0.85rem;
    }

    .debug-logs::-webkit-scrollbar {
      width: 6px;
    }

    .debug-logs::-webkit-scrollbar-track {
      background: rgba(0, 0, 0, 0.1);
      border-radius: 3px;
    }

    .debug-logs::-webkit-scrollbar-thumb {
      background: linear-gradient(135deg, #f59e0b, #d97706);
      border-radius: 3px;
    }

    .debug-log-item {
      margin-bottom: 1rem;
      padding: 0.8rem;
      border-radius: 8px;
      border-left: 4px solid #6b7280;
      background: rgba(255, 255, 255, 0.7);
    }

    .debug-log-item.log-info {
      border-left-color: #3b82f6;
      background: rgba(219, 234, 254, 0.5);
    }

    .debug-log-item.log-success {
      border-left-color: #10b981;
      background: rgba(220, 252, 231, 0.5);
    }

    .debug-log-item.log-error {
      border-left-color: #ef4444;
      background: rgba(254, 226, 226, 0.5);
    }

    .debug-log-item.log-warning {
      border-left-color: #f59e0b;
      background: rgba(254, 243, 199, 0.5);
    }

    .log-time {
      font-size: 0.75rem;
      color: #6b7280;
      margin-bottom: 0.3rem;
    }

    .log-content {
      font-weight: 500;
      margin-bottom: 0.5rem;
    }

    .log-data {
      background: rgba(0, 0, 0, 0.8);
      color: #10b981;
      padding: 0.8rem;
      border-radius: 6px;
      overflow-x: auto;
    }

    .log-data pre {
      margin: 0;
      white-space: pre-wrap;
      word-break: break-all;
    }

    .no-logs {
      text-align: center;
      color: #6b7280;
      font-style: italic;
      padding: 2rem;
    }

    .audio-controls {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 0.5rem;
      margin: 1rem 0;
    }

    .audio-controls .btn {
      padding: 0.6rem;
      font-size: 0.85rem;
      border-radius: 8px;
    }

    /* TTSÊ®°ÂºèÊ†∑ÂºèË∞ÉÊï¥ */
    .tts-container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 2rem;
    }

    .tts-form-card, .tts-result-card {
      background: var(--card-bg);
      border-radius: 20px;
      box-shadow: var(--card-shadow);
      padding: 2rem;
      border: 1px solid rgba(255, 255, 255, 0.3);
      backdrop-filter: blur(10px);
      position: relative;
      overflow: hidden;
    }

    .tts-form-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
      border-radius: 20px 20px 0 0;
    }

    .tts-result-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, #ff6b6b 0%, #feca57 100%);
      border-radius: 20px 20px 0 0;
    }

    .tts-form-card h3, .tts-result-card h3 {
      margin-top: 0;
      margin-bottom: 1.5rem;
      color: var(--text-color);
      font-size: 1.2rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .tts-form-card h3 i {
      color: #667eea;
    }

    .tts-result-card h3 i {
      color: #ff6b6b;
    }

    /* Âä†ËΩΩÁä∂ÊÄÅ */
    .loading-message {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      color: var(--gray);
      font-style: italic;
    }

    .loading-message .spinner {
      width: 16px;
      height: 16px;
      border: 2px solid var(--border-color);
      border-top: 2px solid var(--primary-color);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    /* ÂìçÂ∫îÂºèËÆæËÆ° */
    @media (max-width: 768px) {
      .chat-container, .tts-container {
        grid-template-columns: 1fr;
        height: auto;
      }
      
      .chat-area {
        height: 60vh;
      }
      
      .mode-toggle .btn {
        padding: 0.6rem 1.5rem;
        font-size: 0.9rem;
      }
    }

    h1 {
      text-align: center;
      color: var(--text-color);
      margin-bottom: 2.5rem;
      font-weight: 700;
      font-size: 2rem;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #ff6b6b 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      position: relative;
      padding-bottom: 1rem;
    }

    h1::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 60px;
      height: 3px;
      background: linear-gradient(90deg, #667eea 0%, #ff6b6b 100%);
      border-radius: 2px;
    }

    .form-group {
      margin-bottom: 1.5rem;
    }

    label {
      display: block;
      font-weight: 600;
      margin-bottom: 0.5rem;
      color: var(--text-color);
    }

    input[type="text"],
    input[type="password"],
    input[type="number"],
    select,
    textarea {
      width: 100%;
      padding: 1rem 1.2rem;
      border: 2px solid rgba(102, 126, 234, 0.2);
      border-radius: 12px;
      font-size: 1rem;
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(10px);
      transition: all 0.3s ease;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    }

    input[type="text"]:focus,
    input[type="password"]:focus,
    input[type="number"]:focus,
    select:focus,
    textarea:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1), 0 4px 12px rgba(0, 0, 0, 0.1);
      transform: translateY(-1px);
    }

    textarea {
      resize: vertical;
      min-height: 120px;
    }

    .textarea-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.85rem;
      color: var(--gray);
      margin-top: 0.5rem;
    }

    .clear-btn {
      background: none;
      border: none;
      color: var(--primary-color);
      cursor: pointer;
      padding: 0.2rem 0.5rem;
      border-radius: 4px;
      transition: background-color 0.2s;
    }

    .clear-btn:hover {
      background-color: rgba(79, 70, 229, 0.1);
    }

    .label-with-controls {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.5rem;
    }

    .pause-controls {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .pause-input {
      width: 6.5em;
      padding: 0.4rem 0.6rem;
      border: 1px solid var(--border-color);
      border-radius: 6px;
      font-size: 0.9rem;
      text-align: center;
    }

    .pause-input:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 2px rgba(79, 70, 229, 0.15);
    }

    .btn-insert-pause {
      background: linear-gradient(135deg, #6ee7b7, #10b981);
      color: white;
      padding: 0.4rem 0.8rem;
      border: none;
      border-radius: 6px;
      font-size: 0.85rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      white-space: nowrap;
    }

    .btn-insert-pause:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 8px rgba(16, 185, 129, 0.3);
    }

    .btn-insert-pause:active {
      transform: scale(0.95);
    }

    /* AIËÆæÁΩÆÁïåÈù¢ÁâπÊÆäÊ†∑Âºè */
    .label-with-controls {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.5rem;
    }

    .label-with-controls label {
      margin-bottom: 0;
      flex: 1;
    }

    .btn-outline-primary {
      background: rgba(102, 126, 234, 0.1);
      color: var(--primary-color);
      border: 1px solid var(--primary-color);
      box-shadow: none;
    }

    .btn-outline-primary:hover {
      background: var(--primary-color);
      color: white;
    }

    .btn-outline-primary:disabled {
      background: rgba(102, 126, 234, 0.05);
      color: rgba(102, 126, 234, 0.5);
      border-color: rgba(102, 126, 234, 0.3);
      cursor: not-allowed;
      transform: none !important;
    }

    .fa-spin {
      animation: fa-spin 1s infinite linear;
    }

    @keyframes fa-spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Ê®°ÂûãÈÄâÊã©‰∏ãÊãâÊ°ÜÊ†∑Âºè */
    select {
      background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3e%3c/svg%3e");
      background-position: right 0.5rem center;
      background-repeat: no-repeat;
      background-size: 1.5em 1.5em;
      padding-right: 2.5rem;
      appearance: none;
    }

    select:focus {
      background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%23667eea' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3e%3c/svg%3e");
    }

    /* ÊµãËØïÊåâÈíÆÊ†∑Âºè */
    .test-buttons {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 0.5rem;
    }

    .btn-outline-success {
      background: rgba(72, 187, 120, 0.1);
      color: var(--success-color);
      border: 1px solid var(--success-color);
      box-shadow: none;
    }

    .btn-outline-success:hover {
      background: var(--success-color);
      color: white;
    }

    .btn-outline-success:disabled {
      background: rgba(72, 187, 120, 0.05);
      color: rgba(72, 187, 120, 0.5);
      border-color: rgba(72, 187, 120, 0.3);
      cursor: not-allowed;
      transform: none !important;
    }

    .grid-layout {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1.5rem;
    }

    .slider-group {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .slider-group input[type="range"] {
      flex-grow: 1;
      height: 8px;
      border-radius: 4px;
      background: linear-gradient(135deg, #e2e8f0 0%, #cbd5e1 100%);
      outline: none;
      -webkit-appearance: none;
      appearance: none;
      position: relative;
    }

    .slider-group input[type="range"]::-webkit-slider-track {
      height: 8px;
      border-radius: 4px;
      background: linear-gradient(135deg, #e2e8f0 0%, #cbd5e1 100%);
    }

    .slider-group input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 24px;
      height: 24px;
      border-radius: 50%;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
      transition: all 0.3s ease;
    }

    .slider-group input[type="range"]::-webkit-slider-thumb:hover {
      transform: scale(1.1);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
    }

    .slider-group input[type="range"]::-moz-range-thumb {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      cursor: pointer;
      border: none;
      box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
      transition: all 0.3s ease;
    }

    .slider-group input[type="range"]::-moz-range-thumb:hover {
      transform: scale(1.1);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
    }

    .slider-group span {
      font-weight: 600;
      min-width: 60px;
      text-align: right;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      font-size: 0.95rem;
    }

    .button-group {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1.5rem;
      margin-top: 2rem;
    }

    .button-group .btn {
      padding: 1rem 1.5rem;
      font-size: 1rem;
      font-weight: 600;
      border-radius: 16px;
      position: relative;
      overflow: hidden;
    }

    .button-group .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.3);
    }

    .button-group .btn-success {
      background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
      box-shadow: 0 6px 20px rgba(72, 187, 120, 0.3);
    }

    button:active {
      transform: scale(0.97);
    }

    .btn-generate {
      background: linear-gradient(135deg, var(--gray), #475569);
      color: white;
    }

    .btn-stream {
      background: linear-gradient(135deg, var(--success-color), #16a34a);
      color: white;
    }

    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);
    }

    button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    .status {
      margin-top: 1.5rem;
      padding: 1.2rem;
      border-radius: 16px;
      text-align: center;
      font-weight: 500;
      display: none;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.3);
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      animation: slideInUp 0.3s ease-out;
    }

    @keyframes slideInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .status.show {
      display: block;
    }

    .status-info {
      background: linear-gradient(135deg, rgba(219, 234, 254, 0.9) 0%, rgba(147, 197, 253, 0.9) 100%);
      color: #1d4ed8;
      border: 1px solid rgba(147, 197, 253, 0.5);
    }

    .status-success {
      background: linear-gradient(135deg, rgba(220, 252, 231, 0.9) 0%, rgba(134, 239, 172, 0.9) 100%);
      color: #166534;
      border: 1px solid rgba(134, 239, 172, 0.5);
    }

    .status-error {
      background: linear-gradient(135deg, rgba(254, 226, 226, 0.9) 0%, rgba(252, 165, 165, 0.9) 100%);
      color: #dc2626;
      border: 1px solid rgba(252, 165, 165, 0.5);
    }

    audio {
      width: 100%;
      margin-top: 1.5rem;
      border-radius: 16px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(10px);
    }

    .download-section {
      margin-top: 1.5rem;
      text-align: center;
    }

    .btn-download {
      background: var(--btn-warning-gradient);
      color: white;
      padding: 1rem 2rem;
      border: none;
      border-radius: 16px;
      font-size: 0.95rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: inline-flex;
      align-items: center;
      gap: 0.8rem;
      box-shadow: 0 4px 15px rgba(237, 137, 54, 0.3);
      position: relative;
      overflow: hidden;
    }

    .btn-download::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
      transition: left 0.5s;
    }

    .btn-download:hover::before {
      left: 100%;
    }

    .btn-download:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(237, 137, 54, 0.4);
    }

    .btn-download:active {
      transform: scale(0.98);
    }

    details {
      border: 2px solid rgba(102, 126, 234, 0.2);
      border-radius: 16px;
      padding: 1.5rem;
      margin-bottom: 2rem;
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(10px);
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
      transition: all 0.3s ease;
    }

    details:hover {
      border-color: rgba(102, 126, 234, 0.4);
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
    }

    details[open] {
      border-color: var(--primary-color);
      box-shadow: 0 8px 25px rgba(102, 126, 234, 0.15);
    }

    summary {
      font-weight: 600;
      cursor: pointer;
      color: var(--text-color);
      padding: 0.8rem 0;
      font-size: 1.05rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      transition: color 0.3s ease;
    }

    summary:hover {
      color: var(--primary-color);
    }

    summary::marker {
      color: var(--primary-color);
    }

    .checkbox-grid {
      margin-top: 1.5rem;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
    }

    .checkbox-item {
      display: flex;
      align-items: center;
      gap: 0.8rem;
      padding: 0.8rem;
      border-radius: 12px;
      background: rgba(255, 255, 255, 0.7);
      border: 1px solid rgba(102, 126, 234, 0.1);
      transition: all 0.3s ease;
    }

    .checkbox-item:hover {
      background: rgba(255, 255, 255, 0.9);
      border-color: rgba(102, 126, 234, 0.3);
      transform: translateY(-1px);
    }

    .checkbox-item input[type="checkbox"] {
      width: 18px;
      height: 18px;
      margin: 0;
      accent-color: var(--primary-color);
      cursor: pointer;
    }

    .checkbox-item label {
      margin: 0;
      cursor: pointer;
      font-size: 0.9rem;
      color: var(--text-color);
    }

    /* ÁßªÂä®Á´ØÈÄÇÈÖç */
    @media (max-width: 768px) {
      body {
        padding: 0.5rem;
      }

      .app-container {
        padding: 0 0 1rem;
      }

      .container {
        padding: 1.5rem;
        border-radius: 12px;
      }

      h1 {
        font-size: 1.5rem;
        margin-bottom: 1.5rem;
      }

      .grid-layout {
        grid-template-columns: 1fr;
        gap: 1rem;
      }

      .button-group {
        grid-template-columns: 1fr;
      }

      .checkbox-grid {
        grid-template-columns: 1fr;
      }

      .slider-group span {
        min-width: 45px;
        font-size: 0.85rem;
      }

      textarea {
        min-height: 100px;
      }

      .label-with-controls {
        flex-direction: column;
        align-items: flex-start;
        gap: 0.5rem;
      }

      .pause-controls {
        align-self: flex-end;
      }

      .pause-input {
        font-size: 0.85rem;
      }

      .btn-insert-pause {
        font-size: 0.8rem;
        padding: 0.35rem 0.7rem;
      }
    }

    @media (max-width: 480px) {
      .container {
        padding: 1rem;
        margin: 0.5rem;
      }

      .form-group {
        margin-bottom: 1rem;
      }

      input[type="text"],
      input[type="password"],
      select,
      textarea {
        padding: 0.7rem;
        font-size: 16px;
        /* Èò≤Ê≠¢iOSÁº©Êîæ */
      }

      .slider-group {
        gap: 0.5rem;
      }
    }

    /* Âä†ËΩΩÂä®Áîª */
    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top-color: white;
      animation: spin 1s ease-in-out infinite;
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }

    /* Ê®°ÊÄÅÊ°ÜÊ†∑Âºè */
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(8px);
      z-index: 1000;
      display: flex;
      align-items: center;
      justify-content: center;
      animation: fadeIn 0.3s ease-out;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
      }
      to {
        opacity: 1;
      }
    }

    .modal-dialog {
      max-width: 650px;
      width: 90%;
      margin: 0 auto;
      animation: slideInDown 0.3s ease-out;
    }

    @keyframes slideInDown {
      from {
        opacity: 0;
        transform: translateY(-50px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .modal-content {
      background: var(--card-bg);
      border-radius: 24px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
      overflow: hidden;
      border: 1px solid rgba(255, 255, 255, 0.3);
      backdrop-filter: blur(20px);
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1.5rem 2rem;
      border-bottom: 1px solid rgba(255, 255, 255, 0.2);
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      position: relative;
      overflow: hidden;
    }

    .modal-header::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
      animation: shimmer 3s infinite;
    }

    .modal-header h5 {
      margin: 0;
      font-size: 1.3rem;
      font-weight: 600;
      color: white;
      position: relative;
      z-index: 1;
    }

    .modal-close {
      background: rgba(255, 255, 255, 0.2);
      border: 1px solid rgba(255, 255, 255, 0.3);
      border-radius: 8px;
      width: 32px;
      height: 32px;
      font-size: 1.2rem;
      cursor: pointer;
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
      position: relative;
      z-index: 1;
    }

    .modal-close:hover {
      background: rgba(255, 255, 255, 0.3);
      transform: scale(1.1);
    }

    .modal-body {
      padding: 2rem;
      max-height: 70vh;
      overflow-y: auto;
    }

    .modal-body::-webkit-scrollbar {
      width: 6px;
    }

    .modal-body::-webkit-scrollbar-track {
      background: rgba(0, 0, 0, 0.1);
      border-radius: 3px;
    }

    .modal-body::-webkit-scrollbar-thumb {
      background: linear-gradient(135deg, #667eea, #764ba2);
      border-radius: 3px;
    }

    .modal-footer {
      display: flex;
      justify-content: flex-end;
      gap: 1rem;
      padding: 1.5rem 2rem;
      border-top: 1px solid rgba(255, 255, 255, 0.2);
      background: rgba(248, 250, 252, 0.8);
      backdrop-filter: blur(10px);
    }

    /* ÈÄöÁî®ÊåâÈíÆÊ†∑Âºè */
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      padding: 0.75rem 1.5rem;
      border: none;
      border-radius: 12px;
      font-weight: 600;
      font-size: 0.95rem;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      text-decoration: none;
      position: relative;
      overflow: hidden;
      backdrop-filter: blur(10px);
    }

    .btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
      transition: left 0.5s;
    }

    .btn:hover::before {
      left: 100%;
    }

    .btn:active {
      transform: scale(0.98);
    }

    .btn-primary {
      background: var(--btn-gradient);
      color: white;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
    }

    .btn-secondary {
      background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);
      color: white;
      box-shadow: 0 4px 15px rgba(107, 114, 128, 0.3);
    }

    .btn-secondary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(107, 114, 128, 0.4);
    }

    .btn-success {
      background: var(--btn-success-gradient);
      color: white;
      box-shadow: 0 4px 15px rgba(72, 187, 120, 0.3);
    }

    .btn-success:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(72, 187, 120, 0.4);
    }

    .btn-warning {
      background: var(--btn-warning-gradient);
      color: white;
      box-shadow: 0 4px 15px rgba(237, 137, 54, 0.3);
    }

    .btn-warning:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(237, 137, 54, 0.4);
    }

    .btn-outline {
      background: rgba(255, 255, 255, 0.9);
      color: var(--primary-color);
      border: 2px solid var(--primary-color);
      box-shadow: 0 2px 8px rgba(102, 126, 234, 0.1);
    }

    .btn-outline:hover {
      background: var(--primary-color);
      color: white;
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.3);
    }

    .btn-sm {
      padding: 0.5rem 1rem;
      font-size: 0.85rem;
      border-radius: 8px;
    }

    .btn-lg {
      padding: 1rem 2rem;
      font-size: 1.1rem;
      border-radius: 16px;
    }

    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none !important;
      box-shadow: none !important;
    }

    .btn:disabled::before {
      display: none;
    }

    .help-text {
      font-size: 0.85rem;
      color: var(--gray);
      margin-top: 0.25rem;
    }
  </style>
</head>

<body>
  <div id="app" class="app-container">
    <main class="container">
      <h1 v-cloak>{{ title }}</h1>

      <!-- Ê®°ÂºèÂàáÊç¢ -->
      <div class="mode-toggle">
        <div class="btn-group" role="group">
          <button type="button" 
                  class="btn" 
                  :class="{ active: currentMode === 'chat' }"
                  @click="switchMode('chat')">
            <i class="fas fa-comments"></i> AIÂØπËØùÊ®°Âºè
          </button>
          <button type="button" 
                  class="btn" 
                  :class="{ active: currentMode === 'tts' }"
                  @click="switchMode('tts')">
            <i class="fas fa-microphone"></i> TTSÊ®°Âºè
          </button>
        </div>
      </div>

      <!-- AIÂØπËØùÊ®°Âºè -->
      <div v-show="currentMode === 'chat'" class="chat-container">
        <!-- ÂØπËØùÂå∫Âüü -->
        <div class="chat-area">
          <div class="chat-header">
            <h3><i class="fas fa-robot"></i> AIÊô∫ËÉΩÂØπËØù</h3>
            <div>
              <button class="btn btn-sm btn-light" @click="showAISettings = true" title="AIËÆæÁΩÆ">
                <i class="fas fa-cog"></i>
              </button>
              <button class="btn btn-sm btn-light" @click="showDebugPanel = !showDebugPanel" title="Ë∞ÉËØïÈù¢Êùø">
                <i class="fas fa-bug"></i>
              </button>
              <button class="btn btn-sm btn-light" @click="cleanChatHistory" title="Ê∏ÖÁêÜÈîôËØØÊ∂àÊÅØ">
                <i class="fas fa-broom"></i>
              </button>
              <button class="btn btn-sm btn-light" @click="clearChat" title="Ê∏ÖÁ©∫ÂØπËØù">
                <i class="fas fa-trash"></i>
              </button>
            </div>
          </div>
          
          <div class="chat-messages" ref="chatMessages">
            <div v-if="chatHistory.length === 0" class="text-center p-4">
              <i class="fas fa-robot fa-3x text-primary mb-3"></i>
              <h5>‰Ω†Â•ΩÔºÅÊàëÊòØ‰Ω†ÁöÑAIËØ≠Èü≥Âä©Êâã ü§ñ</h5>
              <p class="text-muted">ÊàëÂèØ‰ª•Âíå‰Ω†ËÅäÂ§©ÔºåÂπ∂‰∏î‰ºöÁî®ËØ≠Èü≥ÊúóËØªÊàëÁöÑÂõûÂ§çÂì¶ÔΩû</p>
            </div>
            
            <div v-for="(message, index) in chatHistory" :key="index" 
                 class="message" :class="message.role">
              <div class="message-avatar">
                <i :class="message.role === 'user' ? 'fas fa-user' : 'fas fa-robot'"></i>
              </div>
              <div class="message-content">
                {{ message.content }}
                <div v-if="message.role === 'assistant'" class="message-controls">
                  <button class="btn btn-sm btn-outline-primary" 
                          @click="speakText(message.content)"
                          :disabled="isGeneratingVoice">
                    <i class="fas fa-volume-up"></i> ÊúóËØª
                  </button>
                </div>
              </div>
            </div>
            
            <div v-if="isThinking" class="message ai">
              <div class="message-avatar">
                <i class="fas fa-robot"></i>
              </div>
              <div class="message-content">
                <div class="loading-message">
                  <div class="spinner"></div>
                  AIÊ≠£Âú®ÊÄùËÄÉ‰∏≠...
                </div>
              </div>
            </div>
          </div>
          
          <div class="chat-input-area">
            <div class="input-group">
              <textarea v-model="chatInput"
                        @keydown.enter.exact.prevent="sendMessage()"
                        placeholder="ËæìÂÖ•‰Ω†ÊÉ≥ËØ¥ÁöÑËØù..."
                        rows="2"
                        :disabled="isThinking"></textarea>
              <div class="input-group-append">
                <button class="btn btn-primary"
                        @click="sendMessage()"
                        :disabled="isThinking || !chatInput.trim()">
                  <i class="fas fa-paper-plane"></i>
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Ë∞ÉËØïÈù¢Êùø -->
        <div v-show="showDebugPanel" class="debug-panel" v-cloak>
          <h3><i class="fas fa-bug"></i> Ë∞ÉËØï‰ø°ÊÅØ
            <small style="font-weight: normal; color: #6b7280;">
              ({{ debugLogs.length }} Êù°Êó•Âøó)
            </small>
          </h3>
          <div class="debug-controls">
            <button @click="clearDebugLogs" class="btn btn-sm btn-outline-primary">
              <i class="fas fa-trash"></i> Ê∏ÖÁ©∫Êó•Âøó
            </button>
            <button @click="exportDebugLogs" class="btn btn-sm btn-outline-primary">
              <i class="fas fa-download"></i> ÂØºÂá∫Êó•Âøó
            </button>
            <button @click="showDebugPanel = false" class="btn btn-sm btn-outline-primary">
              <i class="fas fa-times"></i> ÂÖ≥Èó≠
            </button>
          </div>
          <div class="debug-logs" ref="debugLogs">
            <div v-for="(log, index) in debugLogs" :key="'log-' + index"
                 class="debug-log-item" :class="'log-' + log.type">
              <div class="log-time">{{ log.time }}</div>
              <div class="log-content">{{ log.message }}</div>
              <div v-if="log.data" class="log-data">
                <pre>{{ log.data }}</pre>
              </div>
            </div>
            <div v-if="debugLogs.length === 0" class="no-logs">
              <i class="fas fa-info-circle"></i> ÊöÇÊó†Ë∞ÉËØïÊó•Âøó
              <br><small>ÊâßË°åAIÂØπËØùÊàñÊµãËØïÂäüËÉΩÂêé‰ºöÊòæÁ§∫ËØ¶ÁªÜÊó•Âøó</small>
            </div>
          </div>
        </div>

        <!-- ËØ≠Èü≥ÊéßÂà∂Èù¢Êùø -->
        <div class="voice-control-panel" :class="{ 'with-debug': showDebugPanel }">
          <h3><i class="fas fa-volume-up"></i> ËØ≠Èü≥ÊéßÂà∂</h3>
          
          <div class="form-group">
            <label for="chatVoice">ÈÄâÊã©ËØ≠Èü≥Ôºö</label>
            <select id="chatVoice" v-model="chatSettings.voice" class="form-control">
              <option value="zh-CN-XiaoxiaoNeural">‰∏≠ÊñáÂ•≥Â£∞ (ÊôìÊôì)</option>
              <option value="zh-CN-YunxiNeural">‰∏≠ÊñáÁî∑Â£∞ (‰∫ëÂ∏å)</option>
              <option value="zh-CN-YunyangNeural">‰∏≠ÊñáÁî∑Â£∞ (‰∫ëÊâ¨)</option>
              <option value="zh-CN-XiaoyiNeural">‰∏≠ÊñáÂ•≥Â£∞ (Êôì‰ºä)</option>
              <option value="zh-CN-YunjianNeural">‰∏≠ÊñáÁî∑Â£∞ (‰∫ëÂÅ•)</option>
              <option value="zh-CN-XiaochenNeural">‰∏≠ÊñáÂ•≥Â£∞ (ÊôìËæ∞)</option>
              <option value="zh-CN-XiaohanNeural">‰∏≠ÊñáÂ•≥Â£∞ (ÊôìÊ∂µ)</option>
              <option value="zh-CN-XiaomengNeural">‰∏≠ÊñáÂ•≥Â£∞ (ÊôìÊ¢¶)</option>
              <option value="zh-CN-XiaomoNeural">‰∏≠ÊñáÂ•≥Â£∞ (ÊôìÂ¢®)</option>
              <option value="zh-CN-XiaoqiuNeural">‰∏≠ÊñáÂ•≥Â£∞ (ÊôìÁßã)</option>
              <option value="zh-CN-XiaoruiNeural">‰∏≠ÊñáÂ•≥Â£∞ (ÊôìÁùø)</option>
              <option value="zh-CN-XiaoshuangNeural">‰∏≠ÊñáÂ•≥Â£∞ (ÊôìÂèå)</option>
              <option value="zh-CN-XiaoxuanNeural">‰∏≠ÊñáÂ•≥Â£∞ (ÊôìËê±)</option>
              <option value="zh-CN-XiaoyanNeural">‰∏≠ÊñáÂ•≥Â£∞ (ÊôìÈ¢ú)</option>
              <option value="zh-CN-XiaoyouNeural">‰∏≠ÊñáÂ•≥Â£∞ (ÊôìÊÇ†)</option>
              <option value="zh-CN-XiaozhenNeural">‰∏≠ÊñáÂ•≥Â£∞ (ÊôìÁîÑ)</option>
              <option value="zh-CN-YunfengNeural">‰∏≠ÊñáÁî∑Â£∞ (‰∫ëÊû´)</option>
              <option value="zh-CN-YunhaoNeural">‰∏≠ÊñáÁî∑Â£∞ (‰∫ëÁöì)</option>
              <option value="zh-CN-YunxiaNeural">‰∏≠ÊñáÁî∑Â£∞ (‰∫ëÂ§è)</option>
              <option value="zh-CN-YunyeNeural">‰∏≠ÊñáÁî∑Â£∞ (‰∫ëÈáé)</option>
              <option value="zh-CN-YunzeNeural">‰∏≠ÊñáÁî∑Â£∞ (‰∫ëÊ≥Ω)</option>
              <option value="en-US-JennyNeural">Ëã±ÊñáÂ•≥Â£∞ (Jenny)</option>
              <option value="en-US-GuyNeural">Ëã±ÊñáÁî∑Â£∞ (Guy)</option>
              <option value="en-US-AriaNeural">Ëã±ÊñáÂ•≥Â£∞ (Aria)</option>
              <option value="en-US-DavisNeural">Ëã±ÊñáÁî∑Â£∞ (Davis)</option>
            </select>
          </div>

          <div class="form-group">
            <label>ËØ≠ÈÄü: <span>{{ chatSettings.speed.toFixed(2) }}</span></label>
            <div class="slider-group">
              <input type="range" v-model.number="chatSettings.speed" 
                     min="0.25" max="2.0" step="0.05" class="form-control-range" />
            </div>
          </div>

          <div class="form-group">
            <label>Èü≥Ë∞É: <span>{{ chatSettings.pitch.toFixed(2) }}</span></label>
            <div class="slider-group">
              <input type="range" v-model.number="chatSettings.pitch" 
                     min="0.5" max="1.5" step="0.05" class="form-control-range" />
            </div>
          </div>

          <div class="audio-controls">
            <button class="btn btn-success btn-sm" @click="playAudio" :disabled="!currentAudio">
              <i class="fas fa-play"></i> Êí≠Êîæ
            </button>
            <button class="btn btn-warning btn-sm" @click="pauseAudio" :disabled="!currentAudio">
              <i class="fas fa-pause"></i> ÊöÇÂÅú
            </button>
            <button class="btn btn-danger btn-sm" @click="stopAudio" :disabled="!currentAudio">
              <i class="fas fa-stop"></i> ÂÅúÊ≠¢
            </button>
            <button class="btn btn-info btn-sm" @click="replayAudio" :disabled="!currentAudio">
              <i class="fas fa-redo"></i> ÈáçÊí≠
            </button>
          </div>

          <div class="form-check mt-3">
            <input class="form-check-input" type="checkbox" 
                   id="autoSpeak" v-model="chatSettings.autoSpeak">
            <label class="form-check-label" for="autoSpeak">
              Ëá™Âä®ÊúóËØªAIÂõûÂ§ç
            </label>
          </div>
          

          <audio ref="chatAudio" style="display: none;"></audio>
        </div>
      </div>

      <!-- TTSÊ®°Âºè -->
      <div v-show="currentMode === 'tts'" class="tts-container">
        <div class="tts-form-card">
          <h3><i class="fas fa-microphone"></i> ÊñáÊú¨ËΩ¨ËØ≠Èü≥</h3>
          
          <details>
            <summary>API ÈÖçÁΩÆ</summary>
            <div class="form-group" style="margin-top: 1rem">
              <label for="baseUrl">API Base URL</label>
              <input type="text" id="baseUrl" v-model="config.baseUrl" @input="saveConfig" placeholder="https://‰Ω†ÁöÑÂüüÂêç" />
            </div>
            <div class="form-group" style="margin-bottom: 0">
              <label for="apiKey">API Key</label>
              <input type="password" id="apiKey" v-model="config.apiKey" @input="saveConfig" placeholder="‰Ω†ÁöÑÂØÜÈí•" />
            </div>
          </details>
<!DOCTYPE html>
<html lang="zh-Hans">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <title>üéôÔ∏è AIËØ≠Èü≥Âä©Êâã | Êô∫ËÉΩÂØπËØù+TTSÊúçÂä° (v4.0)</title>
  <style>
    :root {
      --primary-color: #4f46e5;
      --success-color: #22c55e;
      --error-color: #ef4444;
      --warning-color: #f59e0b;
      --light-gray: #f8fafc;
      --gray: #64748b;
      --border-color: #e2e8f0;
      --text-color: #1e293b;
      --mint-start: #f0fdfa;
      --mint-middle: #e6fffa;
      --mint-end: #fdf2f8;
      --mint-accent: #6ee7b7;
    }

    * {
      box-sizing: border-box;
    }

    html {
      padding: 0;
      margin: 0;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
        "Helvetica Neue", Arial, sans-serif;
      background: linear-gradient(135deg, var(--mint-start) 0%, var(--mint-middle) 50%, var(--mint-end) 100%);
      min-height: 100vh;
      color: var(--text-color);
      line-height: 1.6;
      padding: 0;
      margin: 0;
    }

    [v-cloak] {
      display: none;
    }

    .app-container {
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
      padding: 1rem 0 2rem;
    }

    .container {
      max-width: 1200px;
      width: 100%;
      background-color: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      padding: 2rem;
      border-radius: 16px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1), 0 8px 16px rgba(0, 0, 0, 0.06);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    /* Ê®°ÂºèÂàáÊç¢Ê†∑Âºè */
    .mode-toggle {
      text-align: center;
      margin-bottom: 2rem;
    }

    .mode-toggle .btn-group {
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      border-radius: 25px;
      overflow: hidden;
    }

    .mode-toggle .btn {
      padding: 0.8rem 2rem;
      font-weight: 600;
      border: none;
      transition: all 0.3s ease;
    }

    .mode-toggle .btn.active {
      background: linear-gradient(135deg, var(--primary-color), var(--mint-accent));
      color: white;
      transform: scale(1.05);
    }

    .mode-toggle .btn:not(.active) {
      background: rgba(255, 255, 255, 0.8);
      color: var(--text-color);
    }

    /* AIÂØπËØùÊ®°ÂºèÊ†∑Âºè */
    .chat-container {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 2rem;
      height: 70vh;
    }

    .chat-area {
      display: flex;
      flex-direction: column;
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      overflow: hidden;
    }

    .chat-header {
      background: linear-gradient(135deg, var(--primary-color), var(--mint-accent));
      color: white;
      padding: 1rem;
      display: flex;
      justify-content: between;
      align-items: center;
    }

    .chat-messages {
      flex: 1;
      overflow-y: auto;
      padding: 1rem;
      background: #f8fafc;
    }

    .message {
      margin-bottom: 1rem;
      display: flex;
      align-items: flex-start;
      gap: 0.5rem;
    }

    .message.user {
      flex-direction: row-reverse;
    }

    .message-content {
      max-width: 70%;
      padding: 0.8rem 1rem;
      border-radius: 12px;
      position: relative;
    }

    .message.user .message-content {
      background: linear-gradient(135deg, var(--primary-color), #6366f1);
      color: white;
      border-bottom-right-radius: 4px;
    }

    .message.ai .message-content {
      background: white;
      color: var(--text-color);
      border: 1px solid var(--border-color);
      border-bottom-left-radius: 4px;
    }

    .message-avatar {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.8rem;
      flex-shrink: 0;
    }

    .message.user .message-avatar {
      background: var(--primary-color);
      color: white;
    }

    .message.ai .message-avatar {
      background: var(--mint-accent);
      color: white;
    }

    .message-controls {
      margin-top: 0.5rem;
      display: flex;
      gap: 0.5rem;
    }

    .message-controls .btn {
      padding: 0.2rem 0.5rem;
      font-size: 0.75rem;
      border-radius: 4px;
    }

    .chat-input-area {
      padding: 1rem;
      background: white;
      border-top: 1px solid var(--border-color);
    }

    .chat-input-area .input-group {
      align-items: flex-end;
    }

    .chat-input-area textarea {
      resize: none;
      border-radius: 20px;
      border: 1px solid var(--border-color);
      padding: 0.8rem 1rem;
    }

    .chat-input-area .btn {
      border-radius: 50%;
      width: 45px;
      height: 45px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-left: 0.5rem;
    }

    /* ËØ≠Èü≥ÊéßÂà∂Èù¢ÊùøÊ†∑Âºè */
    .voice-control-panel {
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      padding: 1.5rem;
      height: fit-content;
    }

    .voice-control-panel h3 {
      color: var(--text-color);
      margin-bottom: 1.5rem;
      font-size: 1.2rem;
      font-weight: 600;
    }

    .audio-controls {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 0.5rem;
      margin: 1rem 0;
    }

    .audio-controls .btn {
      padding: 0.6rem;
      font-size: 0.85rem;
      border-radius: 8px;
    }



    /* ÂìçÂ∫îÂºèËÆæËÆ° */
    @media (max-width: 768px) {
      .chat-container, .tts-container {
        grid-template-columns: 1fr;
        height: auto;
      }
      
      .chat-area {
        height: 60vh;
      }
      
      .mode-toggle .btn {
        padding: 0.6rem 1.5rem;
        font-size: 0.9rem;
      }
    }

    /* ÁßªÂä®Á´ØÈÄÇÈÖç */
    @media (max-width: 768px) {
      body {
        padding: 0.5rem;
      }

      .app-container {
        padding: 0 0 1rem;
      }

      .container {
        padding: 1.5rem;
        border-radius: 12px;
      }

      h1 {
        font-size: 1.5rem;
        margin-bottom: 1.5rem;
      }

      .grid-layout {
        grid-template-columns: 1fr;
        gap: 1rem;
      }

      .button-group {
        grid-template-columns: 1fr;
      }

      .checkbox-grid {
        grid-template-columns: 1fr;
      }

      .slider-group span {
        min-width: 45px;
        font-size: 0.85rem;
      }

      textarea {
        min-height: 100px;
      }

      .label-with-controls {
        flex-direction: column;
        align-items: flex-start;
        gap: 0.5rem;
      }

      .pause-controls {
        align-self: flex-end;
      }

      .pause-input {
        font-size: 0.85rem;
      }

      .btn-insert-pause {
        font-size: 0.8rem;
        padding: 0.35rem 0.7rem;
      }
    }

    @media (max-width: 480px) {
      .container {
        padding: 1rem;
        margin: 0.5rem;
      }

      .form-group {
        margin-bottom: 1rem;
      }

      input[type="text"],
      input[type="password"],
      select,
      textarea {
        padding: 0.7rem;
        font-size: 16px;
        /* Èò≤Ê≠¢iOSÁº©Êîæ */
      }

      .slider-group {
        gap: 0.5rem;
      }
    }

    /* Âä†ËΩΩÂä®Áîª */
    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top-color: white;
      animation: spin 1s ease-in-out infinite;
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }
  </style>
</head>

<body>

          <div class="form-group">
            <div class="label-with-controls">
              <label for="inputText">ËæìÂÖ•ÊñáÊú¨</label>
              <div class="pause-controls">
                <input type="number" v-model.number="pauseTime" min="0.01" max="100" step="0.01" placeholder="ÂÅúÈ°øÊó∂Èïø"
                  class="pause-input" />
                <button type="button" @click="insertPause" class="btn-insert-pause" title="Âú®ÂÖâÊ†á‰ΩçÁΩÆÊèíÂÖ•ÂÅúÈ°ø">
                  ÊèíÂÖ•ÂÅúÈ°ø
                </button>
              </div>
            </div>
            <textarea id="inputText" ref="textareaRef" v-model="form.inputText" @input="saveForm"
              placeholder="ËØ∑Âú®ËøôÈáåËæìÂÖ•ÊñáÊú¨ÔºåÁõÆÂâçÂ∞ΩÂèØËÉΩ‰∏çË¶ÅË∂ÖËøá1ÁÇπ5‰∏áÂ≠óÊØèÊ¨°Ôºå‰∏çÁÑ∂‰ºöÊä•Èîô„ÄÇÈü≥Ëâ≤Êò†Â∞ÑÂèØ‰ª•Ëá™Ë°å‰øÆÊîπworkersÁöÑÈÖçÁΩÆ"></textarea>
            <div class="textarea-footer">
              <span v-cloak>{{ charCount }} Â≠óÁ¨¶</span>
              <button class="clear-btn" @click="clearText">Ê∏ÖÈô§</button>
            </div>
          </div>

          <div class="grid-layout">
            <div class="form-group">
              <label for="voice">ÈÄâÊã©Èü≥Ëâ≤ (Model)</label>
              <select id="voice" v-model="form.voice" @change="saveForm">
                <option value="zh-CN-XiaoxiaoNeural">‰∏≠ÊñáÂ•≥Â£∞ (ÊôìÊôì)</option>
                <option value="zh-CN-YunxiNeural">‰∏≠ÊñáÁî∑Â£∞ (‰∫ëÂ∏å)</option>
                <option value="zh-CN-YunyangNeural">‰∏≠ÊñáÁî∑Â£∞ (‰∫ëÊâ¨)</option>
                <option value="zh-CN-XiaoyiNeural">‰∏≠ÊñáÂ•≥Â£∞ (Êôì‰ºä)</option>
                <option value="zh-CN-YunjianNeural">‰∏≠ÊñáÁî∑Â£∞ (‰∫ëÂÅ•)</option>
                <option value="zh-CN-XiaochenNeural">‰∏≠ÊñáÂ•≥Â£∞ (ÊôìËæ∞)</option>
                <option value="zh-CN-XiaohanNeural">‰∏≠ÊñáÂ•≥Â£∞ (ÊôìÊ∂µ)</option>
                <option value="zh-CN-XiaomengNeural">‰∏≠ÊñáÂ•≥Â£∞ (ÊôìÊ¢¶)</option>
                <option value="zh-CN-XiaomoNeural">‰∏≠ÊñáÂ•≥Â£∞ (ÊôìÂ¢®)</option>
                <option value="zh-CN-XiaoqiuNeural">‰∏≠ÊñáÂ•≥Â£∞ (ÊôìÁßã)</option>
                <option value="zh-CN-XiaoruiNeural">‰∏≠ÊñáÂ•≥Â£∞ (ÊôìÁùø)</option>
                <option value="zh-CN-XiaoshuangNeural">‰∏≠ÊñáÂ•≥Â£∞ (ÊôìÂèå)</option>
                <option value="zh-CN-XiaoxuanNeural">‰∏≠ÊñáÂ•≥Â£∞ (ÊôìËê±)</option>
                <option value="zh-CN-XiaoyanNeural">‰∏≠ÊñáÂ•≥Â£∞ (ÊôìÈ¢ú)</option>
                <option value="zh-CN-XiaoyouNeural">‰∏≠ÊñáÂ•≥Â£∞ (ÊôìÊÇ†)</option>
                <option value="zh-CN-XiaozhenNeural">‰∏≠ÊñáÂ•≥Â£∞ (ÊôìÁîÑ)</option>
                <option value="zh-CN-YunfengNeural">‰∏≠ÊñáÁî∑Â£∞ (‰∫ëÊû´)</option>
                <option value="zh-CN-YunhaoNeural">‰∏≠ÊñáÁî∑Â£∞ (‰∫ëÁöì)</option>
                <option value="zh-CN-YunxiaNeural">‰∏≠ÊñáÁî∑Â£∞ (‰∫ëÂ§è)</option>
                <option value="zh-CN-YunyeNeural">‰∏≠ÊñáÁî∑Â£∞ (‰∫ëÈáé)</option>
                <option value="zh-CN-YunzeNeural">‰∏≠ÊñáÁî∑Â£∞ (‰∫ëÊ≥Ω)</option>
                <option value="en-US-JennyNeural">Ëã±ÊñáÂ•≥Â£∞ (Jenny)</option>
                <option value="en-US-GuyNeural">Ëã±ÊñáÁî∑Â£∞ (Guy)</option>
                <option value="en-US-AriaNeural">Ëã±ÊñáÂ•≥Â£∞ (Aria)</option>
                <option value="en-US-DavisNeural">Ëã±ÊñáÁî∑Â£∞ (Davis)</option>
                <option value="en-US-AmberNeural">Ëã±ÊñáÂ•≥Â£∞ (Amber)</option>
                <option value="en-US-AnaNeural">Ëã±ÊñáÂ•≥Â£∞ (Ana)</option>
                <option value="en-US-AshleyNeural">Ëã±ÊñáÂ•≥Â£∞ (Ashley)</option>
                <option value="en-US-BrandonNeural">Ëã±ÊñáÁî∑Â£∞ (Brandon)</option>
                <option value="en-US-ChristopherNeural">Ëã±ÊñáÁî∑Â£∞ (Christopher)</option>
                <option value="en-US-CoraNeural">Ëã±ÊñáÂ•≥Â£∞ (Cora)</option>
                <option value="en-US-ElizabethNeural">Ëã±ÊñáÂ•≥Â£∞ (Elizabeth)</option>
                <option value="en-US-EricNeural">Ëã±ÊñáÁî∑Â£∞ (Eric)</option>
                <option value="en-US-JacobNeural">Ëã±ÊñáÁî∑Â£∞ (Jacob)</option>
                <option value="en-US-JaneNeural">Ëã±ÊñáÂ•≥Â£∞ (Jane)</option>
                <option value="en-US-JasonNeural">Ëã±ÊñáÁî∑Â£∞ (Jason)</option>
                <option value="en-US-MichelleNeural">Ëã±ÊñáÂ•≥Â£∞ (Michelle)</option>
                <option value="en-US-MonicaNeural">Ëã±ÊñáÂ•≥Â£∞ (Monica)</option>
                <option value="en-US-NancyNeural">Ëã±ÊñáÂ•≥Â£∞ (Nancy)</option>
                <option value="en-US-RogerNeural">Ëã±ÊñáÁî∑Â£∞ (Roger)</option>
                <option value="en-US-SaraNeural">Ëã±ÊñáÂ•≥Â£∞ (Sara)</option>
                <option value="en-US-SteffanNeural">Ëã±ÊñáÁî∑Â£∞ (Steffan)</option>
                <option value="en-US-TonyNeural">Ëã±ÊñáÁî∑Â£∞ (Tony)</option>
              </select>
            </div>
            <div class="form-group">
              <label>ËØ≠ÈÄü</label>
              <div class="slider-group">
                <input type="range" v-model.number="form.speed" @input="saveForm" min="0.25" max="2.0" step="0.05" />
                <span v-cloak>{{ speedDisplay }}</span>
              </div>
            </div>
            <div class="form-group">
              <label>Èü≥Ë∞É</label>
              <div class="slider-group">
                <input type="range" v-model.number="form.pitch" @input="saveForm" min="0.5" max="1.5" step="0.05" />
                <span v-cloak>{{ pitchDisplay }}</span>
              </div>
            </div>
          </div>

          <details>
            <summary>È´òÁ∫ßÊñáÊú¨Ê∏ÖÁêÜÈÄâÈ°π</summary>
            <div class="checkbox-grid">
              <label class="checkbox-item">
                <input type="checkbox" v-model="form.cleaning.removeMarkdown" @change="saveForm" />
                ÁßªÈô§ Markdown
              </label>
              <label class="checkbox-item">
                <input type="checkbox" v-model="form.cleaning.removeEmoji" @change="saveForm" />
                ÁßªÈô§ Emoji
              </label>
              <label class="checkbox-item">
                <input type="checkbox" v-model="form.cleaning.removeUrls" @change="saveForm" />
                ÁßªÈô§ URL
              </label>
              <label class="checkbox-item">
                <input type="checkbox" v-model="form.cleaning.removeLineBreaks" @change="saveForm" />
                ÁßªÈô§ÊâÄÊúâÁ©∫ÁôΩ/Êç¢Ë°å
              </label>
              <label class="checkbox-item">
                <input type="checkbox" v-model="form.cleaning.removeCitation" @change="saveForm" />
                ÁßªÈô§ÂºïÁî®Ê†áËÆ∞Êï∞Â≠ó
              </label>
            </div>
            <div class="form-group" style="margin-top: 1rem; margin-bottom: 0">
              <label for="customKeywords">Ëá™ÂÆö‰πâÁßªÈô§ÂÖ≥ÈîÆËØç (ÈÄóÂè∑ÂàÜÈöî)</label>
              <input type="text" id="customKeywords" v-model="form.cleaning.customKeywords" @input="saveForm"
                placeholder="‰æãÂ¶Ç: ABC,XYZ" />
            </div>
          </details>

          <div class="button-group">
            <button class="btn-generate" v-cloak :disabled="isLoading" @click="generateSpeech(false)">
              <span v-if="isLoading && !isStreaming" class="loading"></span>
              {{ isLoading && !isStreaming ? 'ÁîüÊàê‰∏≠...' : 'ÁîüÊàêËØ≠Èü≥ (Ê†áÂáÜ)' }}
            </button>
            <button class="btn-stream" v-cloak :disabled="isLoading" @click="generateSpeech(true)">
              <span v-if="isLoading && isStreaming" class="loading"></span>
              {{ isLoading && isStreaming ? 'ÊµÅÂºèÊí≠Êîæ‰∏≠...' : 'ÁîüÊàêËØ≠Èü≥ (ÊµÅÂºè)' }}
            </button>
          </div>
        </div>

        <div class="tts-result-card">
          <h3><i class="fas fa-play-circle"></i> Êí≠ÊîæÁªìÊûú</h3>
          
          <div class="status" :class="['status-' + status.type, { show: status.show }]" v-cloak>
            {{ status.message }}
          </div>

          <audio ref="audioPlayer" controls v-show="audioSrc" v-cloak :src="audioSrc" 
                 @loadstart="onAudioLoadStart" @canplay="onAudioCanPlay"></audio>

          <div v-if="showDownloadBtn" class="download-section" v-cloak>
            <button class="btn-download" @click="downloadAudio">
              <span>üì•</span> ‰∏ãËΩΩÈü≥È¢ëÊñá‰ª∂
            </button>
          </div>
        </div>
      </div>

      <!-- AIËÆæÁΩÆÂºπÁ™ó -->
      <div v-if="showAISettings" class="modal">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5><i class="fas fa-robot"></i> AIÂä©ÊâãËÆæÁΩÆ</h5>
              <button @click="showAISettings = false" class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
              <div class="form-group">
                <label for="aiBaseUrl">AI APIÂü∫Á°ÄÂú∞ÂùÄ:</label>
                <input type="url" id="aiBaseUrl" v-model="aiSettings.baseUrl"
                       placeholder="https://api.openai.com"
                       @blur="onBaseUrlChange"
                       style="font-size: 0.9rem;">
                <div class="help-text">
                  Âü∫Á°ÄURLÔºåÁ≥ªÁªü‰ºöËá™Âä®ÊãºÊé•Ë∑ØÂæÑ<br>
                  ‚Ä¢ ÂØπËØùÊé•Âè£Ôºö/v1/chat/completions<br>
                  ‚Ä¢ Ê®°ÂûãÂàóË°®Ôºö/v1/models
                </div>
              </div>

              <div class="form-group">
                <label for="aiApiKey">APIÂØÜÈí•:</label>
                <input type="password" id="aiApiKey" v-model="aiSettings.apiKey"
                       placeholder="sk-..."
                       @blur="onApiKeyChange">
              </div>

              <div class="form-group">
                <div class="label-with-controls">
                  <label for="aiModel">Ê®°Âûã:</label>
                  <button @click="fetchModels"
                          :disabled="isLoadingModels || !aiSettings.baseUrl || !aiSettings.apiKey"
                          class="btn btn-sm btn-outline-primary">
                    <i class="fas fa-sync-alt" :class="{ 'fa-spin': isLoadingModels }"></i>
                    {{ isLoadingModels ? 'Ëé∑Âèñ‰∏≠...' : 'Ëé∑ÂèñÊ®°Âûã' }}
                  </button>
                </div>
                <select id="aiModel" v-model="aiSettings.model" v-if="availableModels.length > 0">
                  <option v-for="model in availableModels" :key="model.id" :value="model.id">
                    {{ model.id }}
                  </option>
                </select>
                <input v-else type="text" id="aiModel" v-model="aiSettings.model"
                       placeholder="gpt-3.5-turbo">
                <div class="help-text" v-if="availableModels.length === 0">
                  ËØ∑ÂÖàÈÖçÁΩÆAPIÂú∞ÂùÄÂíåÂØÜÈí•ÔºåÁÑ∂ÂêéÁÇπÂáª"Ëé∑ÂèñÊ®°Âûã"ÊåâÈíÆ
                </div>
                <div class="help-text" v-else>
                  Â∑≤Ëé∑ÂèñÂà∞ {{ availableModels.length }} ‰∏™ÂèØÁî®Ê®°Âûã
                </div>
              </div>
              
              <div class="form-group">
                <label for="aiSystemPrompt">Á≥ªÁªüÊèêÁ§∫ËØçÔºàÊô∫ËÉΩ‰ΩìËÆæÂÆöÔºâ:</label>
                <textarea id="aiSystemPrompt" v-model="aiSettings.systemPrompt" rows="4" 
                          placeholder="‰Ω†ÊòØ‰∏Ä‰∏™ÂèãÂñÑ„ÄÅÊúâË∂£ÁöÑAIËØ≠Èü≥Âä©Êâã„ÄÇËØ∑Áî®ÁÆÄÊ¥Å„ÄÅËá™ÁÑ∂ÁöÑËØ≠Ë®ÄÂõûÂ§çÁî®Êà∑Ôºå‰øùÊåÅÂØπËØùËΩªÊùæÊÑâÂø´„ÄÇÂõûÂ§çÈïøÂ∫¶ÊéßÂà∂Âú®100Â≠ó‰ª•ÂÜÖÔºåÈô§ÈùûÁî®Êà∑ÁâπÂà´Ë¶ÅÊ±ÇËØ¶ÁªÜËß£Èáä„ÄÇ"></textarea>
                <div class="help-text">ËøôÈáåËÆæÁΩÆAIÁöÑËßíËâ≤ÂíåË°å‰∏∫ÊñπÂºèÔºåÁ±ª‰ººÊô∫ËÉΩ‰ΩìÁöÑÊèêÁ§∫ËØç</div>
              </div>
              
              <div class="form-group">
                <label>ÂàõÈÄ†ÊÄß (Temperature): <span>{{ aiSettings.temperature.toFixed(1) }}</span></label>
                <div class="slider-group">
                  <input type="range" v-model.number="aiSettings.temperature" 
                         min="0.1" max="2.0" step="0.1" />
                  <span>{{ aiSettings.temperature.toFixed(1) }}</span>
                </div>
                <div class="help-text">ÂÄºË∂äÈ´òÂõûÂ§çË∂äÊúâÂàõÊÑè: {{ aiSettings.temperature.toFixed(1) }}</div>
              </div>
              
              <div class="form-group">
                <label for="aiMaxTokens">ÊúÄÂ§ßÂõûÂ§çÈïøÂ∫¶:</label>
                <input type="number" id="aiMaxTokens" v-model.number="aiSettings.maxTokens"
                       min="50" max="4000" placeholder="150">
                <div class="help-text">ÊéßÂà∂AIÂõûÂ§çÁöÑÊúÄÂ§ßÈïøÂ∫¶</div>
              </div>

              <div class="form-group">
                <label>ËøûÊé•ÊµãËØï:</label>
                <div class="test-buttons">
                  <button @click="testConnection"
                          :disabled="!aiSettings.baseUrl || !aiSettings.apiKey || isTestingConnection"
                          class="btn btn-sm btn-outline-primary">
                    <i class="fas fa-plug" :class="{ 'fa-spin': isTestingConnection }"></i>
                    {{ isTestingConnection ? 'ÊµãËØï‰∏≠...' : 'ÊµãËØïËøûÊé•' }}
                  </button>
                  <button @click="testModel"
                          :disabled="!aiSettings.baseUrl || !aiSettings.apiKey || !aiSettings.model || isTestingModel"
                          class="btn btn-sm btn-outline-success">
                    <i class="fas fa-robot" :class="{ 'fa-spin': isTestingModel }"></i>
                    {{ isTestingModel ? 'ÊµãËØï‰∏≠...' : 'ÊµãËØïÊ®°Âûã' }}
                  </button>
                </div>
                <div class="help-text">ÊµãËØïAPIËøûÊé•ÂíåÊ®°ÂûãÂèØÁî®ÊÄß</div>
              </div>
            </div>
            <div class="modal-footer">
              <button @click="showAISettings = false" class="btn btn-secondary">ÂèñÊ∂à</button>
              <button @click="saveAISettings" class="btn btn-primary">‰øùÂ≠òËÆæÁΩÆ</button>
            </div>
          </div>
        </div>
      </div>
<!DOCTYPE html>
<html lang="zh-Hans">


  <!-- Font Awesome CDN -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  
  <!-- Vue 3 CDN -->
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>

  <script>
    const { createApp } = Vue;

    createApp({
      data() {
        return {
          title: 'üéôÔ∏è AIËØ≠Èü≥Âä©Êâã | Êô∫ËÉΩÂØπËØù+TTSÊúçÂä° (v4.0)',
          currentMode: 'chat', // ÂΩìÂâçÊ®°ÂºèÔºöchat Êàñ tts
          
          // TTS Áõ∏ÂÖ≥Êï∞ÊçÆ
          isLoading: false,
          isStreaming: false,
          audioSrc: '',
          downloadUrl: '',
          showDownloadBtn: false,
          pauseTime: 1.0,
          config: {
            baseUrl: 'https://‰Ω†ÁöÑÂüüÂêç',
            apiKey: '‰Ω†ÁöÑÂØÜÈí•'
          },
          form: {
            inputText: 'ËØ∑Âú®ËøôÈáåËæìÂÖ•ÊñáÊú¨ÔºåÁõÆÂâçÂ∞ΩÂèØËÉΩ‰∏çË¶ÅË∂ÖËøá1ÁÇπ5‰∏áÂ≠óÊØèÊ¨°Ôºå‰∏çÁÑ∂‰ºöÊä•Èîô„ÄÇÈü≥Ëâ≤Êò†Â∞ÑÂèØ‰ª•Ëá™Ë°å‰øÆÊîπworkersÁöÑÈÖçÁΩÆ',
            voice: 'zh-CN-XiaoxiaoNeural',
            speed: 1.0,
            pitch: 1.0,
            cleaning: {
              removeMarkdown: true,
              removeEmoji: true,
              removeUrls: true,
              removeLineBreaks: true,
              removeCitation: true,
              customKeywords: ''
            }
          },
          status: {
            show: false,
            message: '',
            type: 'info'
          },
          
          // AI ÂØπËØùÁõ∏ÂÖ≥Êï∞ÊçÆ
          chatInput: '',
          chatHistory: [],
          isThinking: false,
          isGeneratingVoice: false,
          currentAudio: null,
          showAISettings: false,
          
          // AI ËÆæÁΩÆ
          aiSettings: {
            baseUrl: 'https://api.openai.com',
            apiKey: '',
            model: 'gpt-3.5-turbo',
            systemPrompt: '‰Ω†ÊòØ‰∏Ä‰∏™ÂèãÂñÑ„ÄÅÊúâË∂£ÁöÑAIËØ≠Èü≥Âä©Êâã„ÄÇËØ∑Áî®ÁÆÄÊ¥Å„ÄÅËá™ÁÑ∂ÁöÑËØ≠Ë®ÄÂõûÂ§çÁî®Êà∑Ôºå‰øùÊåÅÂØπËØùËΩªÊùæÊÑâÂø´„ÄÇÂõûÂ§çÈïøÂ∫¶ÊéßÂà∂Âú®100Â≠ó‰ª•ÂÜÖÔºåÈô§ÈùûÁî®Êà∑ÁâπÂà´Ë¶ÅÊ±ÇËØ¶ÁªÜËß£Èáä„ÄÇ',
            temperature: 0.7,
            maxTokens: 150
          },

          // ÂèØÁî®Ê®°ÂûãÂàóË°®
          availableModels: [],
          isLoadingModels: false,

          // Ë∞ÉËØï‰ø°ÊÅØ
          showDebugPanel: false,
          debugLogs: [],
          isTestingConnection: false,
          isTestingModel: false,
          
          // ËÅäÂ§©ËØ≠Èü≥ËÆæÁΩÆ
          chatSettings: {
            voice: 'zh-CN-XiaoxiaoNeural',
            speed: 1.0,
            pitch: 1.0,
            autoSpeak: true
          }
        }
      },
      computed: {
        charCount() {
          return this.form.inputText.length;
        },
        speedDisplay() {
          return this.form.speed.toFixed(2);
        },
        pitchDisplay() {
          return this.form.pitch.toFixed(2);
        }
      },
      methods: {
        // Ê®°ÂºèÂàáÊç¢
        switchMode(mode) {
          this.currentMode = mode;
          this.saveSettings();
        },
        
        // AI ÂØπËØùÂäüËÉΩ
        async sendMessage(userMessageParam = null, retryCount = 0) {
          // Ê£ÄÊü•Á¨¨‰∏Ä‰∏™ÂèÇÊï∞ÊòØÂê¶ÊòØ‰∫ã‰ª∂ÂØπË±°
          if (userMessageParam && typeof userMessageParam === 'object' && userMessageParam.isTrusted !== undefined) {
            // ËøôÊòØ‰∏Ä‰∏™‰∫ã‰ª∂ÂØπË±°ÔºåÂøΩÁï•ÂÆÉ
            userMessageParam = null;
            retryCount = 0;
          }

          // Â¶ÇÊûúÊòØÈáçËØïË∞ÉÁî®‰∏î‰º†ÂÖ•‰∫ÜÂ≠óÁ¨¶‰∏≤Ê∂àÊÅØÔºå‰ΩøÁî®‰º†ÂÖ•ÁöÑÊ∂àÊÅØÔºõÂê¶Âàô‰ªéËæìÂÖ•Ê°ÜËé∑Âèñ
          let userMessage;
          if (userMessageParam && typeof userMessageParam === 'string') {
            userMessage = userMessageParam;
          } else {
            if (!this.chatInput.trim() || this.isThinking) return;
            userMessage = this.chatInput.trim();
            this.chatInput = '';
          }

          // Ê∑ªÂä†Áî®Êà∑Ê∂àÊÅØÔºàÂè™Âú®Á¨¨‰∏ÄÊ¨°Â∞ùËØïÊó∂Ê∑ªÂä†Ôºâ
          if (retryCount === 0) {
            const userMsg = {
              role: 'user',
              content: userMessage
            };
            this.chatHistory.push(userMsg);
            this.saveChatHistory(); // Á´ãÂç≥‰øùÂ≠òÁî®Êà∑Ê∂àÊÅØ

            // Ë∞ÉËØïÊó•Âøó
            this.addDebugLog('info', 'Áî®Êà∑Ê∂àÊÅØÂ∑≤Ê∑ªÂä†', {
              messageText: userMessage,
              messageLength: userMessage.length,
              historyLength: this.chatHistory.length,
              lastMessageRole: this.chatHistory[this.chatHistory.length - 1].role,
              lastMessageContent: this.chatHistory[this.chatHistory.length - 1].content
            });

            console.log('‚úÖ Áî®Êà∑Ê∂àÊÅØÂ∑≤Ê∑ªÂä†Âà∞ÂéÜÂè≤:', userMsg);
            console.log('üìù ÂΩìÂâçËÅäÂ§©ÂéÜÂè≤ÈïøÂ∫¶:', this.chatHistory.length);

            // Âº∫Âà∂VueÊõ¥Êñ∞DOM
            this.$forceUpdate();
          }

          this.isThinking = true;
          this.scrollToBottom();

          try {
            const aiResponse = await this.callAI(userMessage);

            // Ê∑ªÂä†AIÂõûÂ§ç
            this.chatHistory.push({
              role: 'assistant',
              content: aiResponse
            });

            this.saveChatHistory();
            this.scrollToBottom();

            // Ëá™Âä®ÊúóËØªAIÂõûÂ§ç
            if (this.chatSettings.autoSpeak) {
              await this.speakText(aiResponse);
            }

          } catch (error) {
            console.error('AIÂõûÂ§çÂ§±Ë¥•:', error);

            // Â¶ÇÊûúÊòØ500ÈîôËØØ‰∏îÊòØÁ¨¨‰∏ÄÊ¨°Â§±Ë¥•ÔºåÂ∞ùËØïÊ∏ÖÁêÜÂéÜÂè≤ÂêéÈáçËØï
            if (error.message.includes('500') && retryCount === 0 && this.chatHistory.length > 2) {
              this.addDebugLog('warning', 'Ê£ÄÊµãÂà∞500ÈîôËØØÔºåÊ∏ÖÁêÜÂØπËØùÂéÜÂè≤ÂêéÈáçËØï');
              this.updateStatus('Ê£ÄÊµãÂà∞ÊúçÂä°Âô®ÈîôËØØÔºåÊ≠£Âú®Ê∏ÖÁêÜÂéÜÂè≤Âπ∂ÈáçËØï...', 'warning');

              // Ê∏ÖÁêÜÂØπËØùÂéÜÂè≤‰∏≠ÁöÑÈîôËØØÊ∂àÊÅØ
              this.cleanChatHistory();

              // Âª∂Ëøü1ÁßíÂêéÈáçËØïÔºå‰º†ÈÄíÂéüÂßãÁî®Êà∑Ê∂àÊÅØ
              setTimeout(() => {
                this.sendMessage(userMessage, 1); // ‰º†ÈÄíÁî®Êà∑Ê∂àÊÅØÂíåÈáçËØïÊ†áËÆ∞
              }, 1000);

              return;
            }

            this.updateStatus('AIÂõûÂ§çÂ§±Ë¥•: ' + error.message, 'error');

            this.chatHistory.push({
              role: 'assistant',
              content: 'Êä±Ê≠âÔºåÊàëÁé∞Âú®Êó†Ê≥ïÂõûÂ§ç„ÄÇËØ∑Ê£ÄÊü•AIËÆæÁΩÆÊàñÁ®çÂêéÂÜçËØï„ÄÇ'
            });
            this.saveChatHistory(); // ‰øùÂ≠òÈîôËØØÊ∂àÊÅØ
          } finally {
            this.isThinking = false;
          }
        },
        
        async callAI(message) {
          if (!this.aiSettings.apiKey) {
            throw new Error('ËØ∑ÂÖàÂú®ËÆæÁΩÆ‰∏≠ÈÖçÁΩÆAI APIÂØÜÈí•');
          }

          if (!this.aiSettings.baseUrl) {
            throw new Error('ËØ∑ÂÖàÂú®ËÆæÁΩÆ‰∏≠ÈÖçÁΩÆAI APIÂü∫Á°ÄÂú∞ÂùÄ');
          }

          const messages = [];

          // Âè™ÊúâÂΩìÁ≥ªÁªüÊèêÁ§∫ËØç‰∏ç‰∏∫Á©∫Êó∂ÊâçÊ∑ªÂä†systemÊ∂àÊÅØ
          if (this.aiSettings.systemPrompt && this.aiSettings.systemPrompt.trim()) {
            messages.push({ role: 'system', content: this.aiSettings.systemPrompt.trim() });
          }

          // Ê∑ªÂä†ÊúÄËøëÁöÑÂØπËØùÂéÜÂè≤ÔºàÊúÄÂ§ö5Êù°ÔºåÂπ∂ËøáÊª§ÈîôËØØÊ∂àÊÅØÔºâ
          const recentHistory = this.chatHistory
            .slice(-10) // ÂèñÊúÄËøë10Êù°
            .filter(msg => {
              // ËøáÊª§ÊéâÈîôËØØÊ∂àÊÅØÂíåÁ©∫Ê∂àÊÅØ
              if (!msg.content || msg.content.trim() === '') return false;
              if (msg.content.includes('Êä±Ê≠âÔºåÊàëÁé∞Âú®Êó†Ê≥ïÂõûÂ§ç')) return false;
              if (msg.content.includes('ËØ∑Ê£ÄÊü•AIËÆæÁΩÆ')) return false;
              if (msg.content.includes('APIË∞ÉÁî®Â§±Ë¥•')) return false;
              return true;
            })
            .slice(-5); // ÊúÄÁªàÂè™‰øùÁïô5Êù°ÊúâÊïàÂéÜÂè≤

          messages.push(...recentHistory);

          // Ê≥®ÊÑèÔºö‰∏çÈúÄË¶ÅÂÜçÊ¨°Ê∑ªÂä†Áî®Êà∑Ê∂àÊÅØÔºåÂõ†‰∏∫ÂÆÉÂ∑≤ÁªèÂú®recentHistory‰∏≠‰∫Ü
          // Â¶ÇÊûúrecentHistory‰∏∫Á©∫ÔºàÊØîÂ¶ÇÂàöÊ∏ÖÁ©∫ÂéÜÂè≤ÔºâÔºåÊâçÊ∑ªÂä†ÂΩìÂâçÁî®Êà∑Ê∂àÊÅØ
          if (recentHistory.length === 0 ||
              recentHistory[recentHistory.length - 1].content !== message) {
            messages.push({ role: 'user', content: message });
          }

          // ‰º∞ÁÆóTokenÊï∞ÈáèÔºàÁ≤óÁï•‰º∞ÁÆóÔºö1‰∏™‰∏≠ÊñáÂ≠óÁ¨¶‚âà1.5‰∏™tokenÔºå1‰∏™Ëã±ÊñáÂçïËØç‚âà1.3‰∏™tokenÔºâ
          const estimatedTokens = messages.reduce((total, msg) => {
            const content = msg.content || '';
            const chineseChars = (content.match(/[\u4e00-\u9fff]/g) || []).length;
            const englishWords = (content.match(/[a-zA-Z]+/g) || []).length;
            const otherChars = content.length - chineseChars - englishWords;
            return total + Math.ceil(chineseChars * 1.5 + englishWords * 1.3 + otherChars * 0.5);
          }, 0);

          // ËÆ∞ÂΩïÂÆûÈôÖ‰ΩøÁî®ÁöÑÊ∂àÊÅØÊï∞ÈáèÂíåToken‰º∞ÁÆó
          this.addDebugLog('info', `ÊûÑÂª∫Ê∂àÊÅØÂàóË°®ÂÆåÊàêÔºåÂÖ±${messages.length}Êù°Ê∂àÊÅØ`, {
            systemPrompt: !!this.aiSettings.systemPrompt,
            historyCount: recentHistory.length,
            totalMessages: messages.length,
            estimatedTokens: estimatedTokens,
            maxTokens: this.aiSettings.maxTokens,
            messageRoles: messages.map(m => m.role),
            lastUserMessage: message
          });

          // Â¶ÇÊûú‰º∞ÁÆóTokenÊï∞ËøáÂ§öÔºåË≠¶ÂëäÁî®Êà∑
          if (estimatedTokens > this.aiSettings.maxTokens * 0.7) {
            this.addDebugLog('warning', `Token‰ΩøÁî®ÈáèËæÉÈ´ò (${estimatedTokens}/${this.aiSettings.maxTokens})ÔºåÂª∫ËÆÆÊ∏ÖÁêÜÂØπËØùÂéÜÂè≤`);
          }

          // ÊûÑÂª∫ÂÆåÊï¥ÁöÑAPI URL
          const apiUrl = this.aiSettings.baseUrl.replace(/\/$/, '') + '/v1/chat/completions';

          // ÊûÑÂª∫ËØ∑Ê±Ç‰Ωì
          const requestBody = {
            model: this.aiSettings.model,
            messages: messages,
            temperature: this.aiSettings.temperature,
            max_tokens: this.aiSettings.maxTokens
          };

          // Ë∞ÉËØï‰ø°ÊÅØ
          this.addDebugLog('info', 'AI APIË∞ÉÁî®ÂºÄÂßã', {
            url: apiUrl,
            model: this.aiSettings.model,
            requestBody: requestBody,
            apiKeyPrefix: this.aiSettings.apiKey.substring(0, 10) + '...'
          });

          console.log('üöÄ AI APIË∞ÉÁî®ËØ¶ÊÉÖ:');
          console.log('üìç URL:', apiUrl);
          console.log('ü§ñ Ê®°Âûã:', this.aiSettings.model);
          console.log('üìù ËØ∑Ê±Ç‰Ωì:', JSON.stringify(requestBody, null, 2));
          console.log('üîë APIÂØÜÈí•ÂâçÁºÄ:', this.aiSettings.apiKey.substring(0, 10) + '...');

          // Ê£ÄÊü•Ê∂àÊÅØÊ†ºÂºè
          console.log('üìã Ê∂àÊÅØËØ¶ÊÉÖ:');
          messages.forEach((msg, index) => {
            console.log(`  ${index + 1}. ${msg.role}: ${msg.content.substring(0, 50)}${msg.content.length > 50 ? '...' : ''}`);
          });

          let response;
          try {
            response = await fetch(apiUrl, {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${this.aiSettings.apiKey}`,
                'User-Agent': 'AI-Voice-Assistant/1.0'
              },
              body: JSON.stringify(requestBody)
            });

            console.log('üì° ÂìçÂ∫îÁä∂ÊÄÅ:', response.status, response.statusText);
            console.log('üìã ÂìçÂ∫îÂ§¥:', Object.fromEntries(response.headers.entries()));

            this.addDebugLog('info', `Êî∂Âà∞ÂìçÂ∫î: ${response.status} ${response.statusText}`, {
              status: response.status,
              statusText: response.statusText,
              headers: Object.fromEntries(response.headers.entries())
            });

          } catch (networkError) {
            console.error('üåê ÁΩëÁªúÈîôËØØ:', networkError);
            this.addDebugLog('error', 'ÁΩëÁªúËØ∑Ê±ÇÂ§±Ë¥•', { error: networkError.message });
            throw new Error(`ÁΩëÁªúËØ∑Ê±ÇÂ§±Ë¥•: ${networkError.message}`);
          }

          if (!response.ok) {
            let errorData;
            let errorText;

            try {
              errorText = await response.text();
              console.log('‚ùå ÈîôËØØÂìçÂ∫îÂéüÊñá:', errorText);

              // Â∞ùËØïËß£Êûê‰∏∫JSON
              try {
                errorData = JSON.parse(errorText);
              } catch (parseError) {
                console.warn('‚ö†Ô∏è Êó†Ê≥ïËß£ÊûêÈîôËØØÂìçÂ∫î‰∏∫JSON:', parseError);
                errorData = { message: errorText };
              }
            } catch (readError) {
              console.error('üìñ ËØªÂèñÈîôËØØÂìçÂ∫îÂ§±Ë¥•:', readError);
              errorData = { message: 'Êó†Ê≥ïËØªÂèñÈîôËØØ‰ø°ÊÅØ' };
            }

            const errorMessage = errorData.error?.message ||
                               errorData.message ||
                               errorText ||
                               `HTTP ${response.status}: ${response.statusText}`;

            console.error('üí• APIË∞ÉÁî®Â§±Ë¥•:', errorMessage);
            this.addDebugLog('error', 'APIË∞ÉÁî®Â§±Ë¥•', {
              status: response.status,
              statusText: response.statusText,
              errorData: errorData,
              errorText: errorText
            });
            throw new Error(errorMessage);
          }

          let data;
          try {
            const responseText = await response.text();
            console.log('‚úÖ ÊàêÂäüÂìçÂ∫îÂéüÊñá:', responseText);

            data = JSON.parse(responseText);
            console.log('üìä Ëß£ÊûêÂêéÁöÑÂìçÂ∫îÊï∞ÊçÆ:', data);

          } catch (parseError) {
            console.error('üîß Ëß£ÊûêÂìçÂ∫îÂ§±Ë¥•:', parseError);
            throw new Error('APIÂìçÂ∫îÊ†ºÂºèÈîôËØØÔºåÊó†Ê≥ïËß£Êûê');
          }

          if (!data.choices || !data.choices[0] || !data.choices[0].message) {
            console.error('üö´ ÂìçÂ∫îÊï∞ÊçÆÁªìÊûÑÂºÇÂ∏∏:', data);
            throw new Error('APIÂìçÂ∫îÊï∞ÊçÆÁªìÊûÑÂºÇÂ∏∏');
          }

          const aiResponse = data.choices[0].message.content;
          console.log('üéØ AIÂõûÂ§çÂÜÖÂÆπ:', aiResponse);

          this.addDebugLog('success', 'AIÂõûÂ§çÊàêÂäü', {
            response: aiResponse,
            model: this.aiSettings.model,
            tokensUsed: data.usage || 'Êú™Áü•'
          });

          return aiResponse;
        },
        
        // ËØ≠Èü≥ÊúóËØªÂäüËÉΩ
        async speakText(text) {
          if (this.isGeneratingVoice) return;
          
          try {
            this.isGeneratingVoice = true;
            
            const requestBody = {
              voice: this.chatSettings.voice,
              input: text,
              speed: this.chatSettings.speed,
              pitch: this.chatSettings.pitch,
              stream: false
            };
            
            const baseUrl = this.config.baseUrl.trim();
            const apiKey = this.config.apiKey.trim();
            
            if (!baseUrl || !apiKey) {
              throw new Error('ËØ∑ÂÖàÈÖçÁΩÆTTS API');
            }
            
            const response = await fetch(baseUrl + '/v1/audio/speech', {
              method: 'POST',
              headers: {
                'Authorization': 'Bearer ' + apiKey,
                'Content-Type': 'application/json',
              },
              body: JSON.stringify(requestBody),
            });
            
            if (!response.ok) {
              throw new Error(`ËØ≠Èü≥ÁîüÊàêÂ§±Ë¥•: ${response.status}`);
            }
            
            const blob = await response.blob();
            const audioUrl = URL.createObjectURL(blob);
            
            // Êí≠ÊîæÈü≥È¢ë
            if (this.currentAudio) {
              this.currentAudio.pause();
              URL.revokeObjectURL(this.currentAudio.src);
            }
            
            this.currentAudio = new Audio(audioUrl);
            await this.currentAudio.play();
            
          } catch (error) {
            console.error('ËØ≠Èü≥ÊúóËØªÂ§±Ë¥•:', error);
            this.updateStatus('ËØ≠Èü≥ÊúóËØªÂ§±Ë¥•: ' + error.message, 'error');
          } finally {
            this.isGeneratingVoice = false;
          }
        },
        
        // Èü≥È¢ëÊéßÂà∂
        playAudio() {
          if (this.currentAudio && this.currentAudio.paused) {
            this.currentAudio.play();
          }
        },
        
        pauseAudio() {
          if (this.currentAudio && !this.currentAudio.paused) {
            this.currentAudio.pause();
          }
        },
        
        stopAudio() {
          if (this.currentAudio) {
            this.currentAudio.pause();
            this.currentAudio.currentTime = 0;
          }
        },
        
        replayAudio() {
          if (this.currentAudio) {
            this.currentAudio.currentTime = 0;
            this.currentAudio.play();
          }
        },
        
        // Ê∏ÖÁ©∫ÂØπËØù
        clearChat() {
          if (confirm('Á°ÆÂÆöË¶ÅÊ∏ÖÁ©∫ÂØπËØùÂéÜÂè≤ÂêóÔºü')) {
            this.chatHistory = [];
            this.saveChatHistory();
            this.addDebugLog('info', 'ÂØπËØùÂéÜÂè≤Â∑≤Ê∏ÖÁ©∫');
            this.updateStatus('ÂØπËØùÂéÜÂè≤Â∑≤Ê∏ÖÁ©∫', 'success');
          }
        },

        // Ê∏ÖÁêÜÂØπËØùÂéÜÂè≤‰∏≠ÁöÑÈîôËØØÊ∂àÊÅØ
        cleanChatHistory() {
          const originalCount = this.chatHistory.length;
          this.chatHistory = this.chatHistory.filter(msg => {
            if (!msg.content || msg.content.trim() === '') return false;
            if (msg.content.includes('Êä±Ê≠âÔºåÊàëÁé∞Âú®Êó†Ê≥ïÂõûÂ§ç')) return false;
            if (msg.content.includes('ËØ∑Ê£ÄÊü•AIËÆæÁΩÆ')) return false;
            if (msg.content.includes('APIË∞ÉÁî®Â§±Ë¥•')) return false;
            return true;
          });

          const cleanedCount = originalCount - this.chatHistory.length;
          if (cleanedCount > 0) {
            this.saveChatHistory();
            this.addDebugLog('success', `Ê∏ÖÁêÜÂØπËØùÂéÜÂè≤ÂÆåÊàêÔºåÁßªÈô§${cleanedCount}Êù°ÈîôËØØÊ∂àÊÅØ`);
            this.updateStatus(`Â∑≤Ê∏ÖÁêÜ${cleanedCount}Êù°ÈîôËØØÊ∂àÊÅØ`, 'success');
          } else {
            this.addDebugLog('info', 'ÂØπËØùÂéÜÂè≤Êó†ÈúÄÊ∏ÖÁêÜ');
            this.updateStatus('ÂØπËØùÂéÜÂè≤Êó†ÈúÄÊ∏ÖÁêÜ', 'info');
          }
        },
        
        // ÊªöÂä®Âà∞Â∫ïÈÉ®
        scrollToBottom() {
          setTimeout(() => {
            const chatMessages = document.querySelector('.chat-messages');
            if (chatMessages) {
              chatMessages.scrollTop = chatMessages.scrollHeight;
            }
          }, 100);
        },
        
        // AIËÆæÁΩÆÁÆ°ÁêÜ
        saveAISettings() {
          this.saveSettings();
          this.showAISettings = false;
          this.updateStatus('AIËÆæÁΩÆÂ∑≤‰øùÂ≠ò', 'success');
        },

        // Ëé∑ÂèñÂèØÁî®Ê®°ÂûãÂàóË°®
        async fetchModels() {
          if (!this.aiSettings.baseUrl || !this.aiSettings.apiKey) {
            this.updateStatus('ËØ∑ÂÖàÈÖçÁΩÆAPIÂú∞ÂùÄÂíåÂØÜÈí•', 'error');
            return;
          }

          this.isLoadingModels = true;

          try {
            const modelsUrl = this.aiSettings.baseUrl.replace(/\/$/, '') + '/v1/models';

            const response = await fetch(modelsUrl, {
              method: 'GET',
              headers: {
                'Authorization': `Bearer ${this.aiSettings.apiKey}`,
                'Content-Type': 'application/json'
              }
            });

            if (!response.ok) {
              const errorData = await response.json().catch(() => ({}));
              throw new Error(errorData.error?.message || `HTTP ${response.status}: ${response.statusText}`);
            }

            const data = await response.json();

            if (data.data && Array.isArray(data.data)) {
              // ËøáÊª§ÂíåÊéíÂ∫èÊ®°Âûã
              this.availableModels = data.data
                .filter(model => model.id && typeof model.id === 'string')
                .sort((a, b) => a.id.localeCompare(b.id));

              this.updateStatus(`ÊàêÂäüËé∑Âèñ ${this.availableModels.length} ‰∏™Ê®°Âûã`, 'success');

              // Â¶ÇÊûúÂΩìÂâçÈÄâÊã©ÁöÑÊ®°Âûã‰∏çÂú®ÂàóË°®‰∏≠ÔºåÈÄâÊã©Á¨¨‰∏Ä‰∏™ÂèØÁî®Ê®°Âûã
              if (this.availableModels.length > 0) {
                const currentModelExists = this.availableModels.some(model => model.id === this.aiSettings.model);
                if (!currentModelExists) {
                  this.aiSettings.model = this.availableModels[0].id;
                }
              }
            } else {
              throw new Error('APIËøîÂõûÁöÑÊï∞ÊçÆÊ†ºÂºè‰∏çÊ≠£Á°Æ');
            }
          } catch (error) {
            console.error('Ëé∑ÂèñÊ®°ÂûãÂàóË°®Â§±Ë¥•:', error);
            this.updateStatus('Ëé∑ÂèñÊ®°ÂûãÂàóË°®Â§±Ë¥•: ' + error.message, 'error');
            this.availableModels = [];
          } finally {
            this.isLoadingModels = false;
          }
        },

        // Âü∫Á°ÄURLÂèòÂåñÊó∂ÁöÑÂ§ÑÁêÜ
        onBaseUrlChange() {
          // Ê∏ÖÁ©∫Ê®°ÂûãÂàóË°®ÔºåÈúÄË¶ÅÈáçÊñ∞Ëé∑Âèñ
          this.availableModels = [];
        },

        // APIÂØÜÈí•ÂèòÂåñÊó∂ÁöÑÂ§ÑÁêÜ
        onApiKeyChange() {
          // Ê∏ÖÁ©∫Ê®°ÂûãÂàóË°®ÔºåÈúÄË¶ÅÈáçÊñ∞Ëé∑Âèñ
          this.availableModels = [];
        },

        // Ë∞ÉËØïÊó•ÂøóÁÆ°ÁêÜ
        addDebugLog(type, message, data = null) {
          const log = {
            time: new Date().toLocaleTimeString(),
            type: type, // info, success, error, warning
            message: message,
            data: data ? JSON.stringify(data, null, 2) : null
          };

          this.debugLogs.unshift(log);

          // ÈôêÂà∂Êó•ÂøóÊï∞ÈáèÔºåÈÅøÂÖçÂÜÖÂ≠òÂç†Áî®ËøáÂ§ö
          if (this.debugLogs.length > 50) {
            this.debugLogs = this.debugLogs.slice(0, 50);
          }

          // Ëá™Âä®ÊªöÂä®Âà∞ÊúÄÊñ∞Êó•Âøó
          setTimeout(() => {
            const debugLogsElement = document.querySelector('.debug-logs');
            if (debugLogsElement) {
              debugLogsElement.scrollTop = 0;
            }
          }, 100);
        },

        clearDebugLogs() {
          this.debugLogs = [];
          this.addDebugLog('info', 'Ë∞ÉËØïÊó•ÂøóÂ∑≤Ê∏ÖÁ©∫');
        },

        exportDebugLogs() {
          const logs = this.debugLogs.map(log => ({
            time: log.time,
            type: log.type,
            message: log.message,
            data: log.data
          }));

          const dataStr = JSON.stringify(logs, null, 2);
          const dataBlob = new Blob([dataStr], { type: 'application/json' });
          const url = URL.createObjectURL(dataBlob);

          const link = document.createElement('a');
          link.href = url;
          link.download = `ai-debug-logs-${new Date().toISOString().slice(0, 19).replace(/:/g, '-')}.json`;
          document.body.appendChild(link);
          link.click();
          document.body.removeChild(link);

          URL.revokeObjectURL(url);
          this.addDebugLog('success', 'Ë∞ÉËØïÊó•ÂøóÂ∑≤ÂØºÂá∫');
        },

        // ÊµãËØïAPIËøûÊé•
        async testConnection() {
          if (!this.aiSettings.baseUrl || !this.aiSettings.apiKey) {
            this.updateStatus('ËØ∑ÂÖàÈÖçÁΩÆAPIÂú∞ÂùÄÂíåÂØÜÈí•', 'error');
            return;
          }

          this.isTestingConnection = true;
          this.addDebugLog('info', 'ÂºÄÂßãÊµãËØïAPIËøûÊé•');

          try {
            const modelsUrl = this.aiSettings.baseUrl.replace(/\/$/, '') + '/v1/models';

            const response = await fetch(modelsUrl, {
              method: 'GET',
              headers: {
                'Authorization': `Bearer ${this.aiSettings.apiKey}`,
                'Content-Type': 'application/json'
              }
            });

            if (response.ok) {
              this.addDebugLog('success', 'APIËøûÊé•ÊµãËØïÊàêÂäü', {
                status: response.status,
                url: modelsUrl
              });
              this.updateStatus('APIËøûÊé•ÊµãËØïÊàêÂäüÔºÅ', 'success');
            } else {
              const errorText = await response.text();
              this.addDebugLog('error', 'APIËøûÊé•ÊµãËØïÂ§±Ë¥•', {
                status: response.status,
                statusText: response.statusText,
                error: errorText
              });
              this.updateStatus(`APIËøûÊé•ÊµãËØïÂ§±Ë¥•: ${response.status} ${response.statusText}`, 'error');
            }
          } catch (error) {
            this.addDebugLog('error', 'APIËøûÊé•ÊµãËØïÂºÇÂ∏∏', { error: error.message });
            this.updateStatus(`ËøûÊé•ÊµãËØïÂºÇÂ∏∏: ${error.message}`, 'error');
          } finally {
            this.isTestingConnection = false;
          }
        },

        // ÊµãËØïÊ®°ÂûãË∞ÉÁî®
        async testModel() {
          if (!this.aiSettings.baseUrl || !this.aiSettings.apiKey || !this.aiSettings.model) {
            this.updateStatus('ËØ∑ÂÖàÈÖçÁΩÆÂÆåÊï¥ÁöÑAPI‰ø°ÊÅØ', 'error');
            return;
          }

          this.isTestingModel = true;
          this.addDebugLog('info', `ÂºÄÂßãÊµãËØïÊ®°Âûã: ${this.aiSettings.model}`);

          try {
            const testMessage = '‰Ω†Â•ΩÔºåËøôÊòØ‰∏Ä‰∏™ËøûÊé•ÊµãËØïÔºåËØ∑ÁÆÄÂçïÂõûÂ§ç"ÊµãËØïÊàêÂäü"„ÄÇ';
            const response = await this.callAI(testMessage);

            this.addDebugLog('success', 'Ê®°ÂûãÊµãËØïÊàêÂäü', {
              model: this.aiSettings.model,
              testMessage: testMessage,
              response: response
            });
            this.updateStatus(`Ê®°Âûã ${this.aiSettings.model} ÊµãËØïÊàêÂäüÔºÅ`, 'success');

          } catch (error) {
            this.addDebugLog('error', 'Ê®°ÂûãÊµãËØïÂ§±Ë¥•', {
              model: this.aiSettings.model,
              error: error.message
            });
            this.updateStatus(`Ê®°ÂûãÊµãËØïÂ§±Ë¥•: ${error.message}`, 'error');
          } finally {
            this.isTestingModel = false;
          }
        },
        
        // Êï∞ÊçÆÊåÅ‰πÖÂåñ
        saveSettings() {
          try {
            const settings = {
              currentMode: this.currentMode,
              aiSettings: this.aiSettings,
              chatSettings: this.chatSettings,
              config: this.config,
              form: this.form,
              availableModels: this.availableModels
            };
            localStorage.setItem('ai_tts_settings', JSON.stringify(settings));
          } catch (e) {
            console.warn('‰øùÂ≠òËÆæÁΩÆÂ§±Ë¥•:', e);
          }
        },

        loadSettings() {
          try {
            const saved = localStorage.getItem('ai_tts_settings');
            if (saved) {
              const settings = JSON.parse(saved);
              this.currentMode = settings.currentMode || 'chat';
              this.aiSettings = { ...this.aiSettings, ...settings.aiSettings };
              this.chatSettings = { ...this.chatSettings, ...settings.chatSettings };
              this.config = { ...this.config, ...settings.config };
              this.form = { ...this.form, ...settings.form };
              this.availableModels = settings.availableModels || [];

              // ÂÖºÂÆπÊóßÁâàÊú¨ÁöÑapiUrlËÆæÁΩÆ
              if (settings.aiSettings && settings.aiSettings.apiUrl && !settings.aiSettings.baseUrl) {
                // ‰ªéÂÆåÊï¥URL‰∏≠ÊèêÂèñÂü∫Á°ÄURL
                const url = settings.aiSettings.apiUrl;
                if (url.includes('/v1/chat/completions')) {
                  this.aiSettings.baseUrl = url.replace('/v1/chat/completions', '');
                } else if (url.includes('/v1/')) {
                  this.aiSettings.baseUrl = url.substring(0, url.indexOf('/v1/'));
                } else {
                  this.aiSettings.baseUrl = url;
                }
              }
            }
          } catch (e) {
            console.warn('Âä†ËΩΩËÆæÁΩÆÂ§±Ë¥•:', e);
          }
        },
        
        saveChatHistory() {
          try {
            localStorage.setItem('chat_history', JSON.stringify(this.chatHistory));
          } catch (e) {
            console.warn('‰øùÂ≠òËÅäÂ§©ÂéÜÂè≤Â§±Ë¥•:', e);
          }
        },
        
        loadChatHistory() {
          try {
            const saved = localStorage.getItem('chat_history');
            if (saved) {
              this.chatHistory = JSON.parse(saved);
            }
          } catch (e) {
            console.warn('Âä†ËΩΩËÅäÂ§©ÂéÜÂè≤Â§±Ë¥•:', e);
          }
        },
        
        // ÂéüÊúâÁöÑTTSÂäüËÉΩ‰øùÊåÅ‰∏çÂèò
        loadConfig() {
          try {
            const saved = localStorage.getItem('tts_config');
            if (saved) {
              this.config = { ...this.config, ...JSON.parse(saved) };
              if (this.config.baseUrl.endsWith('/')) {
                this.config.baseUrl = this.config.baseUrl.slice(0, -1);
              }
            }
          } catch (e) {
            console.warn('Failed to load config from localStorage:', e);
          }
        },
        saveConfig() {
          try {
            localStorage.setItem('tts_config', JSON.stringify(this.config));
          } catch (e) {
            console.warn('Failed to save config to localStorage:', e);
          }
        },
        loadForm() {
          try {
            const saved = localStorage.getItem('tts_form');
            if (saved) {
              this.form = { ...this.form, ...JSON.parse(saved) };
            }
          } catch (e) {
            console.warn('Failed to load form from localStorage:', e);
          }
        },
        saveForm() {
          try {
            localStorage.setItem('tts_form', JSON.stringify(this.form));
          } catch (e) {
            console.warn('Failed to save form to localStorage:', e);
          }
        },
        clearText() {
          this.form.inputText = '';
          this.saveForm();
        },
        downloadAudio() {
          if (this.downloadUrl) {
            const link = document.createElement('a');
            link.href = this.downloadUrl;
            let timeString = (new Date().toLocaleString() + '-').replace(/[\/\:]/g, '-').replace(/\s/g, '_').replace(/[-_](\d)[-_]/g, '-0$1-').slice(0, -1);
            link.download = 'tts-audio-' + timeString + '.mp3';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
          }
        },
        updateStatus(message, type = 'info') {
          this.status = {
            show: true,
            message,
            type
          };
        },
        hideStatus() {
          this.status.show = false;
        },
        getRequestBody() {
          return {
                voice: this.form.voice,
            input: this.form.inputText.trim(),
            speed: this.form.speed,
            pitch: this.form.pitch,
            cleaning_options: {
              remove_markdown: this.form.cleaning.removeMarkdown,
              remove_emoji: this.form.cleaning.removeEmoji,
              remove_urls: this.form.cleaning.removeUrls,
              remove_line_breaks: this.form.cleaning.removeLineBreaks,
              remove_citation_numbers: this.form.cleaning.removeCitation,
              custom_keywords: this.form.cleaning.customKeywords,
            },
          };
        },
        async generateSpeech(isStream) {
          const baseUrl = this.config.baseUrl.trim(); // ÂéªÈô§Êú´Â∞æÁöÑÊñúÊù†
          const apiKey = this.config.apiKey.trim();
          const text = this.form.inputText.trim();

          if (!baseUrl || !apiKey || !text) {
            this.updateStatus('ËØ∑Â°´ÂÜô API ÈÖçÁΩÆÂíåËæìÂÖ•ÊñáÊú¨', 'error');
            return;
          }

          const requestBody = this.getRequestBody();
          requestBody.stream = isStream;

          this.isLoading = true;
          this.isStreaming = isStream;
          this.audioSrc = '';
          this.showDownloadBtn = false; // ÈáçÁΩÆ‰∏ãËΩΩÊåâÈíÆÁä∂ÊÄÅ
          if (this.downloadUrl) {
            URL.revokeObjectURL(this.downloadUrl); // Ê∏ÖÁêÜ‰πãÂâçÁöÑ‰∏ãËΩΩÈìæÊé•
            this.downloadUrl = '';
          }
          this.updateStatus('Ê≠£Âú®ËøûÊé•ÊúçÂä°Âô®...', 'info');

          try {
            if (isStream) {
              await this.playStreamWithMSE(baseUrl, apiKey, requestBody);
            } else {
              await this.playStandard(baseUrl, apiKey, requestBody);
            }
          } catch (error) {
            console.error('Error generating speech:', error);
            this.updateStatus('ÈîôËØØ: ' + error.message, 'error');
          } finally {
            this.isLoading = false;
            this.isStreaming = false;
          }
        },
        async playStandard(baseUrl, apiKey, body) {
          const response = await fetch(baseUrl + '/v1/audio/speech', {
            method: 'POST',
            headers: {
              'Authorization': 'Bearer ' + apiKey,
              'Content-Type': 'application/json',
            },
            body: JSON.stringify(body),
          });

          if (!response.ok) {
            const errorData = await response.json();
            throw new Error(
              errorData.error?.message ||
              'HTTP error! status: ' + response.status
            );
          }

          const blob = await response.blob();
          this.audioSrc = URL.createObjectURL(blob);
          this.downloadUrl = this.audioSrc; // ÈùûÊµÅÂºèÊ®°ÂºèÁõ¥Êé•‰ΩøÁî®Áõ∏ÂêåÁöÑURL
          this.showDownloadBtn = true;
          this.updateStatus('Êí≠Êîæ‰∏≠...', 'success');

          // Ëá™Âä®Êí≠Êîæ
          this.$nextTick(() => {
            this.$refs.audioPlayer.play().catch(e =>
              console.warn('Autoplay was prevented:', e)
            );
          });
        },
        async playStreamWithMSE(baseUrl, apiKey, body) {
          const mediaSource = new MediaSource();
          this.audioSrc = URL.createObjectURL(mediaSource);

          // Áî®‰∫éÊî∂ÈõÜÈü≥È¢ëÊï∞ÊçÆÁöÑÊï∞ÁªÑ
          const audioChunks = [];

          return new Promise((resolve, reject) => {
            mediaSource.addEventListener('sourceopen', async () => {
              URL.revokeObjectURL(this.audioSrc);
              const sourceBuffer = mediaSource.addSourceBuffer('audio/mpeg');

              try {
                const response = await fetch(baseUrl + '/v1/audio/speech', {
                  method: 'POST',
                  headers: {
                    'Authorization': 'Bearer ' + apiKey,
                    'Content-Type': 'application/json',
                  },
                  body: JSON.stringify(body),
                });

                if (!response.ok) {
                  const errorData = await response.json();
                  throw new Error(
                    errorData.error?.message ||
                    'HTTP error! status: ' + response.status
                  );
                }

                this.updateStatus('Â∑≤ËøûÊé•ÔºåÊé•Êî∂Êï∞ÊçÆ‰∏≠...', 'info');

                // Ëá™Âä®Êí≠Êîæ
                this.$nextTick(() => {
                  this.$refs.audioPlayer.play().catch(e =>
                    console.warn('Autoplay was prevented:', e)
                  );
                });

                const reader = response.body.getReader();

                const pump = async () => {
                  const { done, value } = await reader.read();

                  if (done) {
                    if (mediaSource.readyState === 'open' && !sourceBuffer.updating) {
                      mediaSource.endOfStream();
                    }

                    // ÂàõÂª∫ÂÆåÊï¥ÁöÑÈü≥È¢ëÊñá‰ª∂Áî®‰∫é‰∏ãËΩΩ
                    const completeAudioBlob = new Blob(audioChunks, { type: 'audio/mpeg' });
                    this.downloadUrl = URL.createObjectURL(completeAudioBlob);
                    this.showDownloadBtn = true;

                    this.updateStatus('Êí≠ÊîæÂÆåÊØïÔºÅÂèØÁÇπÂáª‰∏ãËΩΩÊåâÈíÆ‰øùÂ≠òÈü≥È¢ë', 'success');
                    resolve();
                    return;
                  }

                  // Êî∂ÈõÜÈü≥È¢ëÊï∞ÊçÆÂùó
                  audioChunks.push(value.slice()); // ‰ΩøÁî®slice()ÂàõÂª∫ÂâØÊú¨

                  if (sourceBuffer.updating) {
                    await new Promise(resolve =>
                      sourceBuffer.addEventListener('updateend', resolve, { once: true })
                    );
                  }

                  sourceBuffer.appendBuffer(value);
                  this.updateStatus('Ê≠£Âú®ÊµÅÂºèÊí≠Êîæ...', 'success');
                };

                sourceBuffer.addEventListener('updateend', pump);
                await pump();
              } catch (error) {
                console.error('Error in MSE streaming:', error);
                this.updateStatus('ÈîôËØØ: ' + error.message, 'error');
                if (mediaSource.readyState === 'open') {
                  try {
                    mediaSource.endOfStream();
                  } catch (e) { }
                }
                reject(error);
              }
            }, { once: true });
          });
        },
        onAudioLoadStart() {
          console.log('Audio loading started');
        },
        onAudioCanPlay() {
          console.log('Audio can play');
        },
        // ÊèíÂÖ•ÂÅúÈ°øÊ†áÁ≠æ
        insertPause() {
          const textarea = this.$refs.textareaRef;
          if (!textarea) return;
          if (!this.pauseTime || this.pauseTime <= 0 || this.pauseTime > 100) {
            window.alert('ÂÅúÈ°øÊó∂Èó¥ÂøÖÈ°ªÂú® 0.01 Âà∞ 100 Áßí‰πãÈó¥', 'error');
            return;
          }

          const start = textarea.selectionStart;
          const end = textarea.selectionEnd;
          const breakTag = '<break time="' + this.pauseTime + 's"/>';

          const newText = this.form.inputText.slice(0, start) +
            breakTag +
            this.form.inputText.slice(end);

          this.form.inputText = newText;

          // ‰øùÊåÅÂÖâÊ†á‰ΩçÁΩÆ
          this.$nextTick(() => {
            const newPos = start + breakTag.length;
            textarea.focus();
            textarea.setSelectionRange(newPos, newPos);
          });
        }
      },
      mounted() {
        this.loadConfig();
        this.loadForm();
        this.loadSettings();
        this.loadChatHistory();

        // Ê∑ªÂä†ÂàùÂßãË∞ÉËØïÊó•Âøó
        this.addDebugLog('info', 'Á≥ªÁªüÂàùÂßãÂåñÂÆåÊàê', {
          version: '1.0.0',
          timestamp: new Date().toISOString(),
          baseUrl: this.aiSettings.baseUrl,
          model: this.aiSettings.model
        });
      },
      beforeUnmount() {
        // Ê∏ÖÁêÜURLÂØπË±°ÔºåÈÅøÂÖçÂÜÖÂ≠òÊ≥ÑÊºè
        if (this.audioSrc) {
          URL.revokeObjectURL(this.audioSrc);
        }
        if (this.downloadUrl && this.downloadUrl !== this.audioSrc) {
          URL.revokeObjectURL(this.downloadUrl);
        }
      }
    }).mount('#app');
  </script>
</body>

</html>